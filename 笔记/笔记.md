|                                                              | 1:在跑 |           | 2：完成 |
| ------------------------------------------------------------ | ------ | --------- | ------- |
| (tfg) [zhoulin@14:27:39node8]$nohup python zaowanqiXGB.py >> zaowanqiXGB 2>&1 & | 20180  |           | 2       |
| (tfg) [zhoulin@09:59:13node3]$nohup python whichcancer.py >> whichcancer 2>&1 & | 16255  |           | 1       |
| (pytor) [zhoulin@10:47:08node4]$nohup python singleTrain.py >> singleTrain 2>&1 & | 132275 |           | 1       |
| (base) [zhoulin@13:44:19node1]$nohup Rscript dancox.R >> dancox 2>&1 & | 57007  |           | 1       |
| (tfg) [zhoulin@16:34:45node5]$nohup python fiveyearOS.py >> fiveyearOS 2>&1 & | 120110 | 4.1.21.59 | 1       |
| python TCGA-pre-crop_2.py --overlap=20 --multiscale=1        |        |           |         |
| (tfg) [zhoulin@21:55:40node8]$nohup python zaowanqiXGB.py >> zaowanqiXGB 2>&1 & | 74820  | 4.3       | 1       |
| (xgbgpu) [zhoulin@16:02:47node4]$nohup python fiveyearOS.py & | test   |           |         |

## Linux

vim批量注释和取消注释：

注释---  :1,3s/^/#/g

取消---  :1,3s/^#//g

tiff(file="shengcunzhuangtai.tiff",res=300,width=600,height=600,compression="lzw")

tar -zcvf test.tar.gz test/

tar -xzvf test.tar.gz

<details><summary>CLICK ME</summary><pre><code>
coadTS <- read.csv('D:/File/wsi/下载数据文件/coadTS.csv')
coadTS <- coadTS[,c(2,4,6)]
coadTSn <- coadTS[which(coadTS$Sample.Type=='Solid Tissue Normal'),]
coadTSn <- coadTSn[order(coadTSn$jie),]
coadTSc <- coadTS[which(coadTS$Sample.Type=='Primary Tumor'),]
coadTSc <- coadTSc[order(coadTSc$jie),]
coadT <- cbind(coadTSn,coadTSc)
colnames(coadT) <- c('filenor','nor','normal','filecan','can','cancer')
</code></pre></details>

## 多组学数据诊断

### mRNA+miRNA+methy450

1、删除包含超过20%缺失值的样本

2、删除包含超过20%缺失值的基因/探针/....

数据地址：D:\File\igpr

```R
#===================================================
#coadread: 表达数据筛选
coadmirna <- data.table::fread('D:/File/igpr/TCGA.COAD.sampleMap%2FmiRNA_HiSeq_gene.gz')
readmirna <- data.table::fread('D:/File/igpr/TCGA.READ.sampleMap%2FmiRNA_HiSeq_gene.gz')
jiao <- intersect(coadmirna$sample,readmirna$sample)
coadmirna <- coadmirna[which(coadmirna$sample %in% jiao),]
readmirna <- readmirna[which(readmirna$sample %in% jiao),]
coadreadmirna <- cbind(coadmirna,readmirna[,-1])
g <- coadreadmirna
g <- tibble::column_to_rownames(g,'sample')
colnum <- ncol(g)
t <- c()
for(i in 1:nrow(g)){
  if(as.numeric(table(g[i,]=='NA'))/colnum > 0.8){
    t <- c(t,i)
  }
}
f <- g[t,]
g <- f
k <- c()
rownum <- nrow(g)
for(i in 1:ncol(g)){
  if(as.numeric(table(g[,i]=='NA'))/rownum > 0.8){
    k <- c(k,i)
  }
}
h <- g[,k]
table(is.na(h))
library(DMwR)
h1 <- knnImputation(h)
table(is.na(h1))
coadreadmirna <- h1
coadmrna <- data.table::fread('D:/File/igpr/TCGA.COAD.sampleMap%2FHiSeqV2.gz')
readmrna <- data.table::fread('D:/File/igpr/TCGA.READ.sampleMap%2FHiSeqV2.gz')
coadreadmrna <- cbind(coadmrna,readmrna[,-1])
coadreadmrna <- tibble::column_to_rownames(coadreadmrna,'sample')
coadmethy <- data.table::fread('D:/File/igpr/TCGA.COAD.sampleMap%2FHumanMethylation450.gz')
readmethy <- data.table::fread('D:/File/igpr/TCGA.READ.sampleMap%2FHumanMethylation450.gz')
coadreadmethy <- cbind(coadmethy,readmethy[,-1])
relate <- data.table::fread('D:/File/igpr/Correlate_Methylation_vs_mRNA_COADREAD-TP_matrix.txt')
coadreadmethy <- tibble::column_to_rownames(coadreadmethy,'sample')
relate <- tibble::column_to_rownames(relate,'Meth_Probe')
coadreadmethy <- coadreadmethy[rownames(relate),]
g <- coadreadmethy
colnum <- ncol(g)
t <- c()
for(i in 1:nrow(g)){
  if(as.numeric(table(g[i,]=='NA'))/colnum > 0.8){
    t <- c(t,i)
  }
}
f <- g[t,]
g <- f
k <- c()
rownum <- nrow(g)
for(i in 1:ncol(g)){
  if(as.numeric(table(g[,i]=='NA'))/rownum > 0.8){
    k <- c(k,i)
  }
}
h <- g[,k]
table(is.na(h))
library(DMwR)
h1 <- knnImputation(h)
coadreadmethy <- h1

readpheo <- data.table::fread('D:/File/igpr/TCGA.READ.sampleMap%2FREAD_clinicalMatrix')
coadpheo <- data.table::fread('D:/File/igpr/TCGA.COAD.sampleMap%2FCOAD_clinicalMatrix')

readcli <- data.table::fread('D:/File/igpr/survival%2FREAD_survival.txt.gz')
coadcli <- data.table::fread('D:/File/igpr/survival%2FCOAD_survival.txt.gz')
readpheo <- readpheo[,c('sampleID','age_at_initial_pathologic_diagnosis',
                        'gender','pathologic_M','pathologic_N','pathologic_T',
                        'pathologic_stage','sample_type')]
coadpheo <- coadpheo[,c('sampleID','age_at_initial_pathologic_diagnosis',
                        'gender','pathologic_M','pathologic_N','pathologic_T',
                        'pathologic_stage','sample_type')]
coadreadpheo <- rbind(coadpheo,readpheo)
coadreadcli <- rbind(coadcli,readcli)

coadreadpheo <- tibble::column_to_rownames(coadreadpheo,'sampleID')
coadreadcli <- coadreadcli[,c(1,3,4,5,6,9,10)]
coadreadcli <- tibble::column_to_rownames(coadreadcli,'sample')
save(coadreadmrna,coadreadmirna,coadreadmethy,coadreadpheo,coadreadcli,file = 'D:/File/igpr/coadread_multiomics.Rdata')

#===================================================
#paad: 表达数据筛选
paadmirna <- data.table::fread('D:/File/igpr/TCGA.PAAD.sampleMap%2FmiRNA_HiSeq_gene.gz')
g <- paadmirna
g <- tibble::column_to_rownames(g,'sample')
colnum <- ncol(g)
t <- c()
for(i in 1:nrow(g)){
  if(as.numeric(table(g[i,]=='NA'))/colnum > 0.8){
    t <- c(t,i)
  }
}
f <- g[t,]
g <- f
k <- c()
rownum <- nrow(g)
for(i in 1:ncol(g)){
  if(as.numeric(table(g[,i]=='NA'))/rownum > 0.8){
    k <- c(k,i)
  }
}
h <- g[,k]
library(DMwR)
h1 <- knnImputation(h)
paadmirna <- h1

paadmrna <- data.table::fread('D:/File/igpr/TCGA.PAAD.sampleMap%2FHiSeqV2.gz')
paadmrna <- tibble::column_to_rownames(paadmrna,'sample')


paadmethy <- data.table::fread('D:/File/igpr/TCGA.PAAD.sampleMap%2FHumanMethylation450.gz')
relate <- data.table::fread('D:/File/igpr/Correlate_Methylation_vs_mRNA_PAAD-TP_matrix.txt')
paadmethy <- tibble::column_to_rownames(paadmethy,'sample')
relate <- tibble::column_to_rownames(relate,'Meth_Probe')
paadmethy <- paadmethy[rownames(relate),]
g <- paadmethy
colnum <- ncol(g)
t <- c()
for(i in 1:nrow(g)){
  if(as.numeric(table(g[i,]=='NA'))/colnum > 0.8){
    t <- c(t,i)
  }
}
f <- g[t,]
g <- f
k <- c()
rownum <- nrow(g)
for(i in 1:ncol(g)){
  if(as.numeric(table(g[,i]=='NA'))/rownum > 0.8){
    k <- c(k,i)
  }
}
h <- g[,k]
#library(DMwR)
h1 <- knnImputation(h)
paadmethy <- h1

paadpheo <- data.table::fread('D:/File/igpr/TCGA.PAAD.sampleMap%2Fpaad_clinicalMatrix')
paadcli <- data.table::fread('D:/File/igpr/survival%2FPAAD_survival.txt.gz')
paadpheo <- paadpheo[,c('sampleID','age_at_initial_pathologic_diagnosis',
                        'gender','pathologic_M','pathologic_N','pathologic_T',
                        'pathologic_stage','sample_type')]

paadpheo <- tibble::column_to_rownames(paadpheo,'sampleID')
paadcli <- paadcli[,c(1,3,4,5,6,9,10)]
paadcli <- tibble::column_to_rownames(paadcli,'sample')
save(paadmrna,paadmirna,paadmethy,paadpheo,paadcli,file = 'D:/File/igpr/paad_multiomics.Rdata')

#===================================================
#esca: 表达数据筛选
escamirna <- data.table::fread('D:/File/igpr/TCGA.ESCA.sampleMap%2FmiRNA_HiSeq_gene.gz')
g <- escamirna
g <- tibble::column_to_rownames(g,'sample')
colnum <- ncol(g)
t <- c()
for(i in 1:nrow(g)){
  if(as.numeric(table(g[i,]=='NA'))/colnum > 0.8){
    t <- c(t,i)
  }
}
f <- g[t,]
g <- f
k <- c()
rownum <- nrow(g)
for(i in 1:ncol(g)){
  if(as.numeric(table(g[,i]=='NA'))/rownum > 0.8){
    k <- c(k,i)
  }
}
h <- g[,k]
#library(DMwR)
h1 <- knnImputation(h)
escamirna <- h1

escamrna <- data.table::fread('D:/File/igpr/TCGA.ESCA.sampleMap%2FHiSeqV2.gz')
escamrna <- tibble::column_to_rownames(escamrna,'sample')
table(is.na(escamrna))

escamethy <- data.table::fread('D:/File/igpr/TCGA.ESCA.sampleMap%2FHumanMethylation450.gz')
relate <- data.table::fread('D:/File/igpr/Correlate_Methylation_vs_mRNA_ESCA-TP_matrix.txt')
escamethy <- tibble::column_to_rownames(escamethy,'sample')
relate <- tibble::column_to_rownames(relate,'Meth_Probe')
escamethy <- escamethy[rownames(relate),]
g <- escamethy
colnum <- ncol(g)
t <- c()
for(i in 1:nrow(g)){
  if(as.numeric(table(g[i,]=='NA'))/colnum > 0.8){
    t <- c(t,i)
  }
}
f <- g[t,]
g <- f
k <- c()
rownum <- nrow(g)
for(i in 1:ncol(g)){
  if(as.numeric(table(g[,i]=='NA'))/rownum > 0.8){
    k <- c(k,i)
  }
}
h <- g[,k]
#library(DMwR)
h1 <- knnImputation(h)
escamethy <- h1

escapheo <- data.table::fread('D:/File/igpr/TCGA.ESCA.sampleMap%2FESCA_clinicalMatrix')
escacli <- data.table::fread('D:/File/igpr/survival%2FESCA_survival.txt.gz')
escapheo <- escapheo[,c('sampleID','age_at_initial_pathologic_diagnosis',
                        'gender','pathologic_M','pathologic_N','pathologic_T',
                        'pathologic_stage','sample_type')]

escapheo <- tibble::column_to_rownames(escapheo,'sampleID')
escacli <- escacli[,c(1,3,4,5,6,9,10)]
escacli <- tibble::column_to_rownames(escacli,'sample')
save(escamrna,escamirna,escamethy,escapheo,escacli,file = 'D:/File/igpr/esca_multiomics.Rdata')

#stad: 表达数据筛选
#===================================================
stadmirna <- data.table::fread('D:/File/igpr/TCGA.STAD.sampleMap%2FmiRNA_HiSeq_gene.gz')
g <- stadmirna
g <- tibble::column_to_rownames(g,'sample')
colnum <- ncol(g)
t <- c()
for(i in 1:nrow(g)){
  if(as.numeric(table(g[i,]=='NA'))/colnum > 0.8){
    t <- c(t,i)
  }
}
f <- g[t,]
g <- f
k <- c()
rownum <- nrow(g)
for(i in 1:ncol(g)){
  if(as.numeric(table(g[,i]=='NA'))/rownum > 0.8){
    k <- c(k,i)
  }
}
h <- g[,k]
#library(DMwR)
h1 <- knnImputation(h)
stadmirna <- h1

stadmrna <- data.table::fread('D:/File/igpr/TCGA.STAD.sampleMap%2FHiSeqV2.gz')
stadmrna <- tibble::column_to_rownames(stadmrna,'sample')


stadmethy <- data.table::fread('D:/File/igpr/TCGA.STAD.sampleMap%2FHumanMethylation450.gz')
relate <- data.table::fread('D:/File/igpr/Correlate_Methylation_vs_mRNA_STAD-TP_matrix.txt')
stadmethy <- tibble::column_to_rownames(stadmethy,'sample')
relate <- tibble::column_to_rownames(relate,'Meth_Probe')
stadmethy <- stadmethy[rownames(relate),]
g <- stadmethy
colnum <- ncol(g)
t <- c()
for(i in 1:nrow(g)){
  if(as.numeric(table(g[i,]=='NA'))/colnum > 0.8){
    t <- c(t,i)
  }
}
f <- g[t,]
g <- f
k <- c()
rownum <- nrow(g)
for(i in 1:ncol(g)){
  if(as.numeric(table(g[,i]=='NA'))/rownum > 0.8){
    k <- c(k,i)
  }
}
h <- g[,k]
#library(DMwR)
h1 <- knnImputation(h)
stadmethy <- h1

stadpheo <- data.table::fread('D:/File/igpr/TCGA.STAD.sampleMap%2FSTAD_clinicalMatrix')
stadcli <- data.table::fread('D:/File/igpr/survival%2FSTAD_survival.txt.gz')
stadpheo <- stadpheo[,c('sampleID','age_at_initial_pathologic_diagnosis',
                        'gender','pathologic_M','pathologic_N','pathologic_T',
                        'pathologic_stage','sample_type')]

stadpheo <- tibble::column_to_rownames(stadpheo,'sampleID')
stadcli <- stadcli[,c(1,3,4,5,6,9,10)]
stadcli <- tibble::column_to_rownames(stadcli,'sample')
save(stadmrna,stadmirna,stadmethy,stadpheo,stadcli,file = 'D:/File/igpr/stad_multiomics.Rdata')

#hnsc: 表达数据筛选
#===================================================
hnscmirna <- data.table::fread('D:/File/igpr/TCGA.HNSC.sampleMap%2FmiRNA_HiSeq_gene.gz')
g <- hnscmirna
g <- tibble::column_to_rownames(g,'sample')
colnum <- ncol(g)
t <- c()
for(i in 1:nrow(g)){
  if(as.numeric(table(g[i,]=='NA'))/colnum > 0.8){
    t <- c(t,i)
  }
}
f <- g[t,]
g <- f
k <- c()
rownum <- nrow(g)
for(i in 1:ncol(g)){
  if(as.numeric(table(g[,i]=='NA'))/rownum > 0.8){
    k <- c(k,i)
  }
}
h <- g[,k]
#library(DMwR)
h1 <- knnImputation(h)
hnscmirna <- h1

hnscmrna <- data.table::fread('D:/File/igpr/TCGA.HNSC.sampleMap%2FHiSeqV2.gz')
hnscmrna <- tibble::column_to_rownames(hnscmrna,'sample')


hnscmethy <- data.table::fread('D:/File/igpr/TCGA.HNSC.sampleMap%2FHumanMethylation450.gz')
relate <- data.table::fread('D:/File/igpr/Correlate_Methylation_vs_mRNA_HNSC-TP_matrix.txt')
hnscmethy <- tibble::column_to_rownames(hnscmethy,'sample')
relate <- tibble::column_to_rownames(relate,'Meth_Probe')
hnscmethy <- hnscmethy[rownames(relate),]
g <- hnscmethy
colnum <- ncol(g)
t <- c()
for(i in 1:nrow(g)){
  if(as.numeric(table(g[i,]=='NA'))/colnum > 0.8){
    t <- c(t,i)
  }
}
f <- g[t,]
g <- f
k <- c()
rownum <- nrow(g)
for(i in 1:ncol(g)){
  if(as.numeric(table(g[,i]=='NA'))/rownum > 0.8){
    k <- c(k,i)
  }
}
h <- g[,k]
#library(DMwR)
h1 <- knnImputation(h)
hnscmethy <- h1

hnscpheo <- data.table::fread('D:/File/igpr/TCGA.HNSC.sampleMap%2FHNSC_clinicalMatrix')
hnsccli <- data.table::fread('D:/File/igpr/survival%2FHNSC_survival.txt.gz')
hnscpheo <- hnscpheo[,c('sampleID','age_at_initial_pathologic_diagnosis',
                        'gender','pathologic_M','pathologic_N','pathologic_T',
                        'pathologic_stage','sample_type')]

hnscpheo <- tibble::column_to_rownames(hnscpheo,'sampleID')
hnsccli <- hnsccli[,c(1,3,4,5,6,9,10)]
hnsccli <- tibble::column_to_rownames(hnsccli,'sample')
save(hnscmrna,hnscmirna,hnscmethy,hnscpheo,hnsccli,file = 'D:/File/igpr/hnsc_multiomics.Rdata')

#lihc: 表达数据筛选
#===================================================

lihcmirna <- data.table::fread('D:/File/igpr/TCGA.LIHC.sampleMap%2FmiRNA_HiSeq_gene.gz')
g <- lihcmirna
g <- tibble::column_to_rownames(g,'sample')
colnum <- ncol(g)
t <- c()
for(i in 1:nrow(g)){
  if(as.numeric(table(g[i,]=='NA'))/colnum > 0.8){
    t <- c(t,i)
  }
}
f <- g[t,]
g <- f
k <- c()
rownum <- nrow(g)
for(i in 1:ncol(g)){
  if(as.numeric(table(g[,i]=='NA'))/rownum > 0.8){
    k <- c(k,i)
  }
}
h <- g[,k]
#library(DMwR)
h1 <- knnImputation(h)
lihcmirna <- h1

lihcmrna <- data.table::fread('D:/File/igpr/TCGA.LIHC.sampleMap%2FHiSeqV2.gz')
lihcmrna <- tibble::column_to_rownames(lihcmrna,'sample')


lihcmethy <- data.table::fread('D:/File/igpr/TCGA.LIHC.sampleMap%2FHumanMethylation450.gz')
relate <- data.table::fread('D:/File/igpr/Correlate_Methylation_vs_mRNA_LIHC-TP_matrix.txt')
lihcmethy <- tibble::column_to_rownames(lihcmethy,'sample')
relate <- tibble::column_to_rownames(relate,'Meth_Probe')
lihcmethy <- lihcmethy[rownames(relate),]
g <- lihcmethy
colnum <- ncol(g)
t <- c()
for(i in 1:nrow(g)){
  if(as.numeric(table(g[i,]=='NA'))/colnum > 0.8){
    t <- c(t,i)
  }
}
f <- g[t,]
g <- f
k <- c()
rownum <- nrow(g)
for(i in 1:ncol(g)){
  if(as.numeric(table(g[,i]=='NA'))/rownum > 0.8){
    k <- c(k,i)
  }
}
h <- g[,k]
#library(DMwR)
h1 <- knnImputation(h)
lihcmethy <- h1

lihcpheo <- data.table::fread('D:/File/igpr/TCGA.LIHC.sampleMap%2FLIHC_clinicalMatrix')
lihccli <- data.table::fread('D:/File/igpr/survival%2FLIHC_survival.txt.gz')
lihcpheo <- lihcpheo[,c('sampleID','age_at_initial_pathologic_diagnosis',
                        'gender','pathologic_M','pathologic_N','pathologic_T',
                        'pathologic_stage','sample_type')]

lihcpheo <- tibble::column_to_rownames(lihcpheo,'sampleID')
lihccli <- lihccli[,c(1,3,4,5,6,9,10)]
lihccli <- tibble::column_to_rownames(lihccli,'sample')
save(lihcmrna,lihcmirna,lihcmethy,lihcpheo,lihccli,file = 'D:/File/igpr/lihc_multiomics.Rdata')

```

### 提取GTEx数据

coad+read对应的GTEx数据：【colon-sigmoid+colon-transverse】==》Colon

esca对应的GTEx数据：Esophagus - Mucosa

stad对应的GTEx数据：Stomach

```R
gtexpheo <- data.table::fread('D:/File/igpr/GTEX_phenotype.gz')
table(gtexpheo$`body_site_detail (SMTSD)`)
table(gtexpheo$`_primary_site`)
gtexpheo <- gtexpheo[which(gtexpheo$`_primary_site`=='Colon'),]
gtexpheo <- tibble::column_to_rownames(gtexpheo,'Sample')

gtexexp <- data.table::fread('D:/File/igpr/gtex_RSEM_Hugo_norm_count.gz')
gtexexp <- tibble::column_to_rownames(gtexexp,'sample')
cg <- intersect(rownames(gtexpheo),colnames(gtexexp))
colongtex <- gtexexp[,cg]
 
escagtexpheno <- gtexpheo[which(gtexpheo$`body_site_detail (SMTSD)`=='Esophagus - Mucosa'),]
escagtexpheno <- tibble::column_to_rownames(escagtexpheno,'Sample')
eg <- intersect(rownames(escagtexpheno),colnames(gtexexp))
escagtex <- gtexexp[,eg]

stadgtexpheno <- gtexpheo[which(gtexpheo$`body_site_detail (SMTSD)`=='Stomach'),]
stadgtexpheno <- tibble::column_to_rownames(stadgtexpheno,'Sample')
sg <- intersect(rownames(stadgtexpheno),colnames(gtexexp))
stadgtex <- gtexexp[,sg]

save(colongtex,escagtex,stadgtex,file='D:/File/igpr/gtexshuju.Rdata')
```

### 提取各个肿瘤正常与癌症样本：mRNA

癌症样本：1

正常样本：0

```R
#coad
load('D:/File/igpr/gtexshuju.Rdata')
load("D:/File/igpr/coad_biaodashuju.Rdata")
gene <- intersect(rownames(coadmrna),rownames(colongtex))
colongtex <- colongtex[gene,]
escagtex <- escagtex[gene,]
stadgtex <- stadgtex[gene,]
coadpheo <- data.table::fread('D:/File/igpr/TCGA.COAD.sampleMap%2FCOAD_clinicalMatrix')
coadpheo <- coadpheo[,c('sampleID','sample_type')]
table(coadpheo$sample_type)
coadpheo <- coadpheo[which(coadpheo$sample_type != ''),]
coadpheo <- coadpheo[which(coadpheo$sample_type != 'Metastatic') ,]
coadpheo <- coadpheo[which(coadpheo$sample_type != 'Recurrent Tumor') ,]
coadpheon <- coadpheo[which(coadpheo$sample_type=='Solid Tissue Normal'),]
coadpheoc <- coadpheo[which(coadpheo$sample_type=='Primary Tumor'),]
coadpheon <- tibble::column_to_rownames(coadpheon,'sampleID')
coadpheoc <- tibble::column_to_rownames(coadpheoc,'sampleID')
coadmrnan <- coadmrna[,intersect(rownames(coadpheon),colnames(coadmrna))]
coadmrnac <- coadmrna[,intersect(rownames(coadpheoc),colnames(coadmrna))]
coadmrnan <- coadmrnan[gene,]
coadmrnac <- coadmrnac[gene,]

#read
load("D:/File/igpr/read_biaodashuju.Rdata")
readpheo <- data.table::fread('D:/File/igpr/TCGA.READ.sampleMap%2FREAD_clinicalMatrix')
readpheo <- readpheo[,c('sampleID','sample_type')]
table(readpheo$sample_type)
readpheo <- readpheo[which(readpheo$sample_type != ''),]
readpheo <- readpheo[which(readpheo$sample_type != 'Metastatic') ,]
readpheo <- readpheo[which(readpheo$sample_type != 'Recurrent Tumor') ,]
readpheon <- readpheo[which(readpheo$sample_type=='Solid Tissue Normal'),]
readpheoc <- readpheo[which(readpheo$sample_type=='Primary Tumor'),]
readpheon <- tibble::column_to_rownames(readpheon,'sampleID')
readpheoc <- tibble::column_to_rownames(readpheoc,'sampleID')
readmrnan <- readmrna[,intersect(rownames(readpheon),colnames(readmrna))]
readmrnac <- readmrna[,intersect(rownames(readpheoc),colnames(readmrna))]
readmrnan <- readmrnan[gene,]
readmrnac <- readmrnac[gene,]

#esca
load("D:/File/igpr/esca_biaodashuju.Rdata")
escapheo <- data.table::fread('D:/File/igpr/TCGA.ESCA.sampleMap%2FESCA_clinicalMatrix')
escapheo <- escapheo[,c('sampleID','sample_type')]
table(escapheo$sample_type)
escapheo <- escapheo[which(escapheo$sample_type != ''),]
escapheo <- escapheo[which(escapheo$sample_type != 'Metastatic') ,]
escapheo <- escapheo[which(escapheo$sample_type != 'Recurrent Tumor') ,]
escapheon <- escapheo[which(escapheo$sample_type=='Solid Tissue Normal'),]
escapheoc <- escapheo[which(escapheo$sample_type=='Primary Tumor'),]
escapheon <- tibble::column_to_rownames(escapheon,'sampleID')
escapheoc <- tibble::column_to_rownames(escapheoc,'sampleID')
escamrnan <- escamrna[,intersect(rownames(escapheon),colnames(escamrna))]
escamrnac <- escamrna[,intersect(rownames(escapheoc),colnames(escamrna))]
escamrnan <- escamrnan[gene,]
escamrnac <- escamrnac[gene,]

#stad
load("D:/File/igpr/stad_biaodashuju.Rdata")
stadpheo <- data.table::fread('D:/File/igpr/TCGA.STAD.sampleMap%2FSTAD_clinicalMatrix')
stadpheo <- stadpheo[,c('sampleID','sample_type')]
table(stadpheo$sample_type)
stadpheo <- stadpheo[which(stadpheo$sample_type != ''),]
stadpheo <- stadpheo[which(stadpheo$sample_type != 'Metastatic') ,]
stadpheo <- stadpheo[which(stadpheo$sample_type != 'Recurrent Tumor') ,]
stadpheon <- stadpheo[which(stadpheo$sample_type=='Solid Tissue Normal'),]
stadpheoc <- stadpheo[which(stadpheo$sample_type=='Primary Tumor'),]
stadpheon <- tibble::column_to_rownames(stadpheon,'sampleID')
stadpheoc <- tibble::column_to_rownames(stadpheoc,'sampleID')
stadmrnan <- stadmrna[,intersect(rownames(stadpheon),colnames(stadmrna))]
stadmrnac <- stadmrna[,intersect(rownames(stadpheoc),colnames(stadmrna))]
stadmrnan <- stadmrnan[gene,]
stadmrnac <- stadmrnac[gene,]

#整合
normal <- cbind(coadmrnan,escamrnan)
normal <- cbind(normal,readmrnan)
normal <- cbind(normal,stadmrnan)
normal <- cbind(normal,colongtex)
normal <- cbind(normal,escagtex)
normal <- cbind(normal,stadgtex)
cancer <- cbind(coadmrnac,escamrnac)
cancer <- cbind(cancer,readmrnac)
cancer <- cbind(cancer,stadmrnac)
normal_t <- as.data.frame(t(normal))
cancer_t <- as.data.frame(t(cancer))
cancer_normal <- rbind(cancer_t,normal_t)
label <- as.data.frame(c(rep(1,nrow(cancer_t)),rep(0,nrow(normal_t))))
colnames(label) <- 'class'
save(cancer_normal,label,file = 'D:/File/igpr/cancer_normal_label.Rdata')
```

```R
#保存为txt
load('D:/File/igpr/whichcancer_7.Rdata')
a <- cbind(data,label[,ncol(label)])
colnames(a)[21483] <- 'class'
set.seed(0)
b <- a[sample(nrow(a)),]
data <- b[,-ncol(b)]
lable <- as.data.frame(b[,ncol(b)])
colnames(lable) <- 'class'
write.table(data,file='D:/File/igpr/whichcancerData_6.txt',row.names = F,sep = '\t')
write.table(label[,ncol(label)],file='D:/File/igpr/whichcancerLabel_6.txt',row.names = F)
```



### 提取肿瘤数据:mRNA+methy+miRNA

coadread:0   esca:1  stad:2  paad:3  lihc:4  hnsc:5

```R
#肿瘤数据
load('D:/File/igpr/coadread_multiomics.Rdata')
load('D:/File/igpr/esca_multiomics.Rdata')
load('D:/File/igpr/stad_multiomics.Rdata')
load('D:/File/igpr/paad_multiomics.Rdata')
load('D:/File/igpr/lihc_multiomics.Rdata')
load('D:/File/igpr/hnsc_multiomics.Rdata')


coadreadbd <- intersect(intersect(colnames(coadreadmrna),colnames(coadreadmirna)),
                        colnames(coadreadmethy))
escabd <- intersect(intersect(colnames(escamrna),colnames(escamirna)),
                    colnames(escamethy))
stadbd <- intersect(intersect(colnames(stadmrna),colnames(stadmirna)),
                    colnames(stadmethy))
paadbd <- intersect(intersect(colnames(paadmrna),colnames(paadmirna)),
                    colnames(paadmethy))
lihcbd <- intersect(intersect(colnames(lihcmrna),colnames(lihcmirna)),
                    colnames(lihcmethy))
hnscbd <- intersect(intersect(colnames(hnscmrna),colnames(hnscmirna)),
                    colnames(hnscmethy))

coadreadpheoc <- coadreadpheo[which(coadreadpheo$sample_type=='Primary Tumor'),]
escapheoc <- escapheo[which(escapheo$sample_type=='Primary Tumor'),]
stadpheoc <- stadpheo[which(stadpheo$sample_type=='Primary Tumor'),]
paadpheoc <- paadpheo[which(paadpheo$sample_type=='Primary Tumor'),]
lihcpheoc <- lihcpheo[which(lihcpheo$sample_type=='Primary Tumor'),]
hnscpheoc <- hnscpheo[which(hnscpheo$sample_type=='Primary Tumor'),]


coadread <- intersect(coadreadbd,rownames(coadreadpheoc))
esca <- intersect(escabd,rownames(escapheoc))
stad <- intersect(stadbd,rownames(stadpheoc))
paad <- intersect(paadbd,rownames(paadpheoc))
lihc <- intersect(lihcbd,rownames(lihcpheoc))
hnsc <- intersect(hnscbd,rownames(hnscpheoc))

coadreadpheoc <- coadreadpheoc[coadread,]
escapheoc <- escapheoc[esca,]
stadpheoc <- stadpheoc[stad,]
paadpheoc <- paadpheoc[paad,]
lihcpheoc <- lihcpheoc[lihc,]
hnscpheoc <- hnscpheoc[hnsc,]

coadreadpheoc$class <- 0
escapheoc$class <- 1
stadpheoc$class <- 2
paadpheoc$class <- 3
lihcpheoc$class <- 4
hnscpheoc$class <- 5

coadreadmrna <- as.data.frame(t(coadreadmrna))
coadreadmirna <- as.data.frame(t(coadreadmirna))
coadreadmethy <- as.data.frame(t(coadreadmethy))
escamrna <- as.data.frame(t(escamrna))
escamirna <- as.data.frame(t(escamirna))
escamethy <- as.data.frame(t(escamethy))
stadmrna <- as.data.frame(t(stadmrna))
stadmirna <- as.data.frame(t(stadmirna))
stadmethy <- as.data.frame(t(stadmethy))
paadmrna <- as.data.frame(t(paadmrna))
paadmirna <- as.data.frame(t(paadmirna))
paadmethy <- as.data.frame(t(paadmethy))
lihcmrna <- as.data.frame(t(lihcmrna))
lihcmirna <- as.data.frame(t(lihcmirna))
lihcmethy <- as.data.frame(t(lihcmethy))
hnscmrna <- as.data.frame(t(hnscmrna))
hnscmirna <- as.data.frame(t(hnscmirna))
hnscmethy <- as.data.frame(t(hnscmethy))

coadreadb <- cbind(cbind(coadreadmrna[coadread,],coadreadmirna[coadread,]),coadreadmethy[coadread,])
escab <- cbind(cbind(escamrna[esca,],escamirna[esca,]),escamethy[esca,])
stadb <- cbind(cbind(stadmrna[stad,],stadmirna[stad,]),stadmethy[stad,])
paadb <- cbind(cbind(paadmrna[paad,],paadmirna[paad,]),paadmethy[paad,])
lihcb <- cbind(cbind(lihcmrna[lihc,],lihcmirna[lihc,]),lihcmethy[lihc,])
hnscb <- cbind(cbind(hnscmrna[hnsc,],hnscmirna[hnsc,]),hnscmethy[hnsc,])

gt <- intersect(intersect(intersect(intersect(intersect(colnames(coadreadb),colnames(escab)),
                colnames(stadb)),colnames(paadb)),colnames(lihcb)),colnames(hnscb))
coadreadb <- coadreadb[,gt]
escab <- escab[,gt]
stadb <- stadb[,gt]
paadb <- paadb[,gt]
lihcb <- lihcb[,gt]
hnscb <- hnscb[,gt]

data <- rbind(coadreadb,escab)
data <- rbind(data,stadb)
data <- rbind(data,paadb)
data <- rbind(data,lihcb)
data <- rbind(data,hnscb)

label <- rbind(coadreadpheoc,escapheoc)
label <- rbind(label,stadpheoc)
label <- rbind(label,paadpheoc)
label <- rbind(label,lihcpheoc)
label <- rbind(label,hnscpheoc)

save(data,label,file = 'D:/File/igpr/whichcancer_7.Rdata')
```

```R
#提取数据和标签
load(file='D:/File/igpr/cancer_label.Rdata')
label$class <- label$class-1
set.seed(0)
a <- cbind(cancer,label)
b <- a[sample(nrow(a)),]
data <- b[,-ncol(b)]
lable <- as.data.frame(b[,ncol(b)])
colnames(lable) <- 'class'
write.table(data,file='D:/File/igpr/whichCancerMultiomic.txt',row.names = F,sep = '\t')
write.table(lable,file='D:/File/igpr/whichCancerLabel.txt',row.names = F)
```



### 早晚期数据

stage I II： 早期：0

stage III IV：晚期：1

```R
#早晚期
load('D:/File/igpr/coadread_multiomics.Rdata')
load('D:/File/igpr/esca_multiomics.Rdata')
load('D:/File/igpr/stad_multiomics.Rdata')
load('D:/File/igpr/paad_multiomics.Rdata')
load('D:/File/igpr/lihc_multiomics.Rdata')
load('D:/File/igpr/hnsc_multiomics.Rdata')


coadreadbd <- intersect(intersect(colnames(coadreadmrna),colnames(coadreadmirna)),
                        colnames(coadreadmethy))
escabd <- intersect(intersect(colnames(escamrna),colnames(escamirna)),
                    colnames(escamethy))
stadbd <- intersect(intersect(colnames(stadmrna),colnames(stadmirna)),
                    colnames(stadmethy))
paadbd <- intersect(intersect(colnames(paadmrna),colnames(paadmirna)),
                    colnames(paadmethy))
lihcbd <- intersect(intersect(colnames(lihcmrna),colnames(lihcmirna)),
                    colnames(lihcmethy))
hnscbd <- intersect(intersect(colnames(hnscmrna),colnames(hnscmirna)),
                    colnames(hnscmethy))

coadreadpheoc <- coadreadpheo[which(coadreadpheo$sample_type=='Primary Tumor'),]
escapheoc <- escapheo[which(escapheo$sample_type=='Primary Tumor'),]
stadpheoc <- stadpheo[which(stadpheo$sample_type=='Primary Tumor'),]
paadpheoc <- paadpheo[which(paadpheo$sample_type=='Primary Tumor'),]
lihcpheoc <- lihcpheo[which(lihcpheo$sample_type=='Primary Tumor'),]
hnscpheoc <- hnscpheo[which(hnscpheo$sample_type=='Primary Tumor'),]

table(coadreadpheoc$pathologic_stage)
coadreadpheoc <- coadreadpheoc[which(coadreadpheoc$pathologic_stage != ""),]
coadreadpheoc <- coadreadpheoc[which(coadreadpheoc$pathologic_stage != "[Discrepancy]"),]
coadreadpheoc[which(coadreadpheoc$pathologic_stage == "Stage I"),6] <- "I"
coadreadpheoc[which(coadreadpheoc$pathologic_stage == "Stage IA"),6] <- "I"
coadreadpheoc[which(coadreadpheoc$pathologic_stage == "Stage IB"),6] <- "I"
table(coadreadpheoc$pathologic_stage)
coadreadpheoc[which(coadreadpheoc$pathologic_stage == "Stage II"),6] <- "II"
coadreadpheoc[which(coadreadpheoc$pathologic_stage == "Stage IIA"),6] <- "II"
coadreadpheoc[which(coadreadpheoc$pathologic_stage == "Stage IIB"),6] <- "II"
coadreadpheoc[which(coadreadpheoc$pathologic_stage == "Stage IIC"),6] <- "II"
table(coadreadpheoc$pathologic_stage)
coadreadpheoc[which(coadreadpheoc$pathologic_stage == "Stage III"),6] <- "III"
coadreadpheoc[which(coadreadpheoc$pathologic_stage == "Stage IIIA"),6] <- "III"
coadreadpheoc[which(coadreadpheoc$pathologic_stage == "Stage IIIB"),6] <- "III"
coadreadpheoc[which(coadreadpheoc$pathologic_stage == "Stage IIIC"),6] <- "III"
coadreadpheoc[which(coadreadpheoc$pathologic_stage == "Stage IV"),6] <- "IV"
coadreadpheoc[which(coadreadpheoc$pathologic_stage == "Stage IVA"),6] <- "IV"
coadreadpheoc[which(coadreadpheoc$pathologic_stage == "Stage IVB"),6] <- "IV"
table(coadreadpheoc$pathologic_stage)

coadread <- intersect(coadreadbd,rownames(coadreadpheoc))
esca <- intersect(escabd,rownames(escapheoc))
stad <- intersect(stadbd,rownames(stadpheoc))
paad <- intersect(paadbd,rownames(paadpheoc))
lihc <- intersect(lihcbd,rownames(lihcpheoc))
hnsc <- intersect(hnscbd,rownames(hnscpheoc))

coadreadpheoc <- coadreadpheoc[coadread,]
escapheoc <- escapheoc[esca,]
stadpheoc <- stadpheoc[stad,]
paadpheoc <- paadpheoc[paad,]
lihcpheoc <- lihcpheoc[lihc,]
hnscpheoc <- hnscpheoc[hnsc,]

tt <- coadreadpheoc[which(coadreadpheoc$pathologic_stage=='I' | coadreadpheoc$pathologic_stage=='II'),]
tt$zaowan <- 0
pp <- coadreadpheoc[which(coadreadpheoc$pathologic_stage=='III' | coadreadpheoc$pathologic_stage=='IV'),]
pp$zaowan <- 1
coadreadpheoc <- rbind(tt,pp)
tt <- escapheoc[which(escapheoc$pathologic_stage=='I' | escapheoc$pathologic_stage=='II'),]
tt$zaowan <- 0
pp <- escapheoc[which(escapheoc$pathologic_stage=='III' | escapheoc$pathologic_stage=='IV'),]
pp$zaowan <- 1
escapheoc <- rbind(tt,pp)
tt <- stadpheoc[which(stadpheoc$pathologic_stage=='I' | stadpheoc$pathologic_stage=='II'),]
tt$zaowan <- 0
pp <- stadpheoc[which(stadpheoc$pathologic_stage=='III' | stadpheoc$pathologic_stage=='IV'),]
pp$zaowan <- 1
stadpheoc <- rbind(tt,pp)
tt <- paadpheoc[which(paadpheoc$pathologic_stage=='I' | paadpheoc$pathologic_stage=='II'),]
tt$zaowan <- 0
pp <- paadpheoc[which(paadpheoc$pathologic_stage=='III' | paadpheoc$pathologic_stage=='IV'),]
pp$zaowan <- 1
paadpheoc <- rbind(tt,pp)
tt <- lihcpheoc[which(lihcpheoc$pathologic_stage=='I' | lihcpheoc$pathologic_stage=='II'),]
tt$zaowan <- 0
pp <- lihcpheoc[which(lihcpheoc$pathologic_stage=='III' | lihcpheoc$pathologic_stage=='IV'),]
pp$zaowan <- 1
lihcpheoc <- rbind(tt,pp)
tt <- hnscpheoc[which(hnscpheoc$pathologic_stage=='I' | hnscpheoc$pathologic_stage=='II'),]
tt$zaowan <- 0
pp <- hnscpheoc[which(hnscpheoc$pathologic_stage=='III' | hnscpheoc$pathologic_stage=='IV'),]
pp$zaowan <- 1
hnscpheoc <- rbind(tt,pp)

coadreadpheoc <- coadreadpheoc[coadread,]
escapheoc <- escapheoc[esca,]
stadpheoc <- stadpheoc[stad,]
paadpheoc <- paadpheoc[paad,]
lihcpheoc <- lihcpheoc[lihc,]
hnscpheoc <- hnscpheoc[hnsc,]

coadreadmrna <- as.data.frame(t(coadreadmrna))
coadreadmirna <- as.data.frame(t(coadreadmirna))
coadreadmethy <- as.data.frame(t(coadreadmethy))
escamrna <- as.data.frame(t(escamrna))
escamirna <- as.data.frame(t(escamirna))
escamethy <- as.data.frame(t(escamethy))
stadmrna <- as.data.frame(t(stadmrna))
stadmirna <- as.data.frame(t(stadmirna))
stadmethy <- as.data.frame(t(stadmethy))
paadmrna <- as.data.frame(t(paadmrna))
paadmirna <- as.data.frame(t(paadmirna))
paadmethy <- as.data.frame(t(paadmethy))
lihcmrna <- as.data.frame(t(lihcmrna))
lihcmirna <- as.data.frame(t(lihcmirna))
lihcmethy <- as.data.frame(t(lihcmethy))
hnscmrna <- as.data.frame(t(hnscmrna))
hnscmirna <- as.data.frame(t(hnscmirna))
hnscmethy <- as.data.frame(t(hnscmethy))

coadreadb <- cbind(cbind(coadreadmrna[coadread,],coadreadmirna[coadread,]),coadreadmethy[coadread,])
escab <- cbind(cbind(escamrna[esca,],escamirna[esca,]),escamethy[esca,])
stadb <- cbind(cbind(stadmrna[stad,],stadmirna[stad,]),stadmethy[stad,])
paadb <- cbind(cbind(paadmrna[paad,],paadmirna[paad,]),paadmethy[paad,])
lihcb <- cbind(cbind(lihcmrna[lihc,],lihcmirna[lihc,]),lihcmethy[lihc,])
hnscb <- cbind(cbind(hnscmrna[hnsc,],hnscmirna[hnsc,]),hnscmethy[hnsc,])

gt <- intersect(intersect(intersect(intersect(intersect(colnames(coadreadb),colnames(escab)),
                colnames(stadb)),colnames(paadb)),colnames(lihcb)),colnames(hnscb))
coadreadb <- coadreadb[,gt]
escab <- escab[,gt]
stadb <- stadb[,gt]
paadb <- paadb[,gt]
lihcb <- lihcb[,gt]
hnscb <- hnscb[,gt]

data <- rbind(coadreadb,escab)
data <- rbind(data,stadb)
data <- rbind(data,paadb)
data <- rbind(data,lihcb)
data <- rbind(data,hnscb)

label <- rbind(coadreadpheoc,escapheoc)
label <- rbind(label,stadpheoc)
label <- rbind(label,paadpheoc)
label <- rbind(label,lihcpheoc)
label <- rbind(label,hnscpheoc)

save(data,label,file = 'D:/File/igpr/zaowanqi_7.Rdata')
```

```R
#提取数据和标签
load('D:/File/igpr/coad_E_L_LABEL.Rdata')
load('D:/File/igpr/read_E_L_LABEL.Rdata')
load('D:/File/igpr/esca_E_L_LABEL.Rdata')
load('D:/File/igpr/stad_E_L_LABEL.Rdata')
coad <- rbind(coad_e,coad_l)
esca <- rbind(esca_e,esca_l)
read <- rbind(read_e,read_l)
stad <- rbind(stad_e,stad_l)
data <- rbind(coad,esca)
data <- rbind(data,read)
data <- rbind(data,stad)
lable <- rbind(coadlabel,escalabel)
lable <- rbind(lable,readlabel)
lable <- rbind(lable,stadlabel)
set.seed(0)
a <- cbind(data,lable)
b <- a[sample(nrow(a)),]
data <- b[,-ncol(b)]
lable <- as.data.frame(b[,ncol(b)])
colnames(lable) <- 'class'
write.table(data,file='D:/File/igpr/zaowanqiMultiomic.txt',row.names = F,sep = '\t')
write.table(lable,file='D:/File/igpr/zaowanqiLabel.txt',row.names = F)
```

## 消化道肿瘤免疫基因对

```R
#数据筛选

#COADREAD
luade <- data.table::fread('lianxi/PMID32798715/COAD/TCGA-COAD.htseq_fpkm.tsv')
surve <- data.table::fread('lianxi/PMID32798715/COAD/TCGA-COAD.survival.tsv')
surve <- surve[,-3]
phenoe <- data.table::fread('lianxi/PMID32798715/COAD/TCGA-COAD.GDC_phenotype.tsv')
phenoe <- phenoe[which(phenoe$sample_type.samples == 'Primary Tumor'),]
phenoe <- phenoe[,c("submitter_id.samples","age_at_initial_pathologic_diagnosis","gender.demographic","pathologic_M",
                  "pathologic_N","pathologic_T","tumor_stage.diagnoses")]
luadr <- data.table::fread('lianxi/PMID32798715/READ/TCGA-READ.htseq_fpkm.tsv')
survr <- data.table::fread('lianxi/PMID32798715/READ/TCGA-READ.survival.tsv')
survr <- survr[,-3]
phenor <- data.table::fread('lianxi/PMID32798715/READ/TCGA-READ.GDC_phenotype.tsv')
phenor <- phenor[which(phenor$sample_type.samples == 'Primary Tumor'),]
phenor <- phenor[,c("submitter_id.samples","age_at_initial_pathologic_diagnosis","gender.demographic","pathologic_M",
                  "pathologic_N","pathologic_T","tumor_stage.diagnoses")]
pheno <- rbind(phenoe,phenor)
pheno <- na.omit(pheno)

table(pheno$pathologic_M)
pheno <- pheno[which(pheno$pathologic_M != ""),]
pheno[which(pheno$pathologic_M == "M1a"),4] <- "M1"
pheno[which(pheno$pathologic_M == "M1b"),4] <- "M1"
pheno[which(pheno$pathologic_M == "MX"),4] <- "M1"
pheno <- pheno[which(pheno$pathologic_M != "MX"),]
table(pheno$pathologic_M)

table(pheno$pathologic_N)
pheno <- pheno[which(pheno$pathologic_N != ""),]
pheno <- pheno[which(pheno$pathologic_N != "NX"),]
pheno[which(pheno$pathologic_N == "N1a"),5] <- "N1"
pheno[which(pheno$pathologic_N == "N1b"),5] <- "N1"
pheno[which(pheno$pathologic_N == "N1c"),5] <- "N1"
pheno[which(pheno$pathologic_N == "N2a"),5] <- "N2"
pheno[which(pheno$pathologic_N == "N2b"),5] <- "N2"
pheno[which(pheno$pathologic_N == "N2c"),5] <- "N2"
pheno[which(pheno$pathologic_N == "N3a"),5] <- "N3"
pheno[which(pheno$pathologic_N == "N3b"),5] <- "N3"
pheno[which(pheno$pathologic_N == "NX"),5] <- "N1"
table(pheno$pathologic_N)

table(pheno$pathologic_T)
pheno <- pheno[which(pheno$pathologic_T != ""),]
pheno <- pheno[which(pheno$pathologic_T != "TX"),]
pheno <- pheno[which(pheno$pathologic_T != "Tis"),]
pheno <- pheno[which(pheno$pathologic_T != "T0"),]
pheno[which(pheno$pathologic_T == "T1a"),6] <- "T1"
pheno[which(pheno$pathologic_T == "T1b"),6] <- "T1"
pheno[which(pheno$pathologic_T == "T2a"),6] <- "T2"
pheno[which(pheno$pathologic_T == "T2b"),6] <- "T2"
pheno[which(pheno$pathologic_T == "T3a"),6] <- "T3"
pheno[which(pheno$pathologic_T == "T3b"),6] <- "T3"
pheno[which(pheno$pathologic_T == "T4a"),6] <- "T4"
pheno[which(pheno$pathologic_T == "T4b"),6] <- "T4"
table(pheno$pathologic_T)

table(pheno$tumor_stage.diagnoses)
pheno <- pheno[which(pheno$tumor_stage.diagnoses != "not reported"),]
pheno[which(pheno$tumor_stage.diagnoses == "stage i"),7] <- "I"
pheno[which(pheno$tumor_stage.diagnoses == "stage ia"),7] <- "I"
pheno[which(pheno$tumor_stage.diagnoses == "stage ib"),7] <- "I"
table(pheno$tumor_stage.diagnoses)
pheno[which(pheno$tumor_stage.diagnoses == "stage ii"),7] <- "II"
pheno[which(pheno$tumor_stage.diagnoses == "stage iia"),7] <- "II"
pheno[which(pheno$tumor_stage.diagnoses == "stage iib"),7] <- "II"
pheno[which(pheno$tumor_stage.diagnoses == "stage iic"),7] <- "II"
table(pheno$tumor_stage.diagnoses)
pheno[which(pheno$tumor_stage.diagnoses == "stage iii"),7] <- "III"
pheno[which(pheno$tumor_stage.diagnoses == "stage iiia"),7] <- "III"
pheno[which(pheno$tumor_stage.diagnoses == "stage iiib"),7] <- "III"
pheno[which(pheno$tumor_stage.diagnoses == "stage iiic"),7] <- "III"
pheno[which(pheno$tumor_stage.diagnoses == "stage iv"),7] <- "IV"
pheno[which(pheno$tumor_stage.diagnoses == "stage iva"),7] <- "IV"
pheno[which(pheno$tumor_stage.diagnoses == "stage ivb"),7] <- "IV"
pheno[which(pheno$tumor_stage.diagnoses == "stage ivc"),7] <- "IV"
table(pheno$tumor_stage.diagnoses)

luade <- tibble::column_to_rownames(luade,"Ensembl_ID")
luadr <- tibble::column_to_rownames(luadr,"Ensembl_ID")
luad <- cbind(luade,luadr)
surv <- rbind(surve,survr)
exp_sample <- colnames(luad)
surv_sample <- surv$sample
pheno_sample <- pheno$submitter_id.samples
jiaoji <- intersect(intersect(pheno_sample,surv_sample),exp_sample)

pheno1 <- pheno[which(pheno$submitter_id.samples %in% jiaoji),]
colnames(pheno1) <- c("sample_id","age","gender","M","N","T","stage")

luad1 <- luad[,jiaoji] 

surv1 <- surv[which(surv$sample %in% jiaoji),]

irg <- data.table::fread('D:/linshiwenjian/r-daima/免疫基因.txt')
irg <- irg[!duplicated(irg$Symbol),]
idmapping <- read.table(file = "lianxi/PMID32798715/gencode.v22.annotation.gene.probeMap", 
                        sep = "\t", header = T, stringsAsFactors = F)
geneid <- data.frame(id = rownames(luad1), stringsAsFactors = F)
geneid2symbol <- dplyr::left_join(geneid, idmapping, by = "id")
luad1$symbol <- geneid2symbol$gene
luad1 <- luad1[which(luad1$symbol %in% irg$Symbol),]
luad1 <- luad1[order(luad1$symbol),]
luad2 <- aggregate(luad1[,c(1:(ncol(luad1)-1))], 
                   by = list(luad1$symbol), mean)
rownames(luad2) <- luad2[,1]
luad2 <- luad2[,-1]
save(luad2,surv1,pheno1,file='D:/File/igpr/coadread_yuanshuju.Rdata')

#HNSC
luad <- data.table::fread('lianxi/PMID32798715/HNSC/TCGA-HNSC.htseq_fpkm.tsv.gz')
surv <- data.table::fread('lianxi/PMID32798715/HNSC/TCGA-HNSC.survival.tsv.gz')
surv <- surv[,-3]
pheno <- data.table::fread('lianxi/PMID32798715/HNSC/TCGA-HNSC.GDC_phenotype.tsv.gz')
pheno <- pheno[which(pheno$sample_type.samples == 'Primary Tumor'),]
pheno <- pheno[,c("submitter_id.samples","age_at_initial_pathologic_diagnosis","gender.demographic","pathologic_M",
                  "pathologic_N","pathologic_T","tumor_stage.diagnoses")]
pheno <- na.omit(pheno)

table(pheno$pathologic_M)
pheno <- pheno[which(pheno$pathologic_M != ""),]
pheno[which(pheno$pathologic_M == "M1a"),4] <- "M1"
pheno[which(pheno$pathologic_M == "M1b"),4] <- "M1"
pheno[which(pheno$pathologic_M == "MX"),4] <- "M1"
pheno <- pheno[which(pheno$pathologic_M != "MX"),]
table(pheno$pathologic_M)

table(pheno$pathologic_N)
pheno <- pheno[which(pheno$pathologic_N != ""),]
pheno <- pheno[which(pheno$pathologic_N != "NX"),]
pheno[which(pheno$pathologic_N == "N1a"),5] <- "N1"
pheno[which(pheno$pathologic_N == "N1b"),5] <- "N1"
pheno[which(pheno$pathologic_N == "N1c"),5] <- "N1"
pheno[which(pheno$pathologic_N == "N2a"),5] <- "N2"
pheno[which(pheno$pathologic_N == "N2b"),5] <- "N2"
pheno[which(pheno$pathologic_N == "N2c"),5] <- "N2"
pheno[which(pheno$pathologic_N == "N3a"),5] <- "N3"
pheno[which(pheno$pathologic_N == "N3b"),5] <- "N3"
table(pheno$pathologic_N)

table(pheno$pathologic_T)
pheno <- pheno[which(pheno$pathologic_T != "TX"),]
pheno <- pheno[which(pheno$pathologic_T != "T0"),]
pheno[which(pheno$pathologic_T == "T1a"),6] <- "T1"
pheno[which(pheno$pathologic_T == "T1b"),6] <- "T1"
pheno[which(pheno$pathologic_T == "T2a"),6] <- "T2"
pheno[which(pheno$pathologic_T == "T2b"),6] <- "T2"
pheno[which(pheno$pathologic_T == "T4a"),6] <- "T4"
pheno[which(pheno$pathologic_T == "T4b"),6] <- "T4"
table(pheno$pathologic_T)

table(pheno$tumor_stage.diagnoses)
pheno <- pheno[which(pheno$tumor_stage.diagnoses != "not reported"),]
pheno[which(pheno$tumor_stage.diagnoses == "stage i"),7] <- "I"
pheno[which(pheno$tumor_stage.diagnoses == "stage ia"),7] <- "I"
pheno[which(pheno$tumor_stage.diagnoses == "stage ib"),7] <- "I"
table(pheno$tumor_stage.diagnoses)
pheno[which(pheno$tumor_stage.diagnoses == "stage ii"),7] <- "II"
pheno[which(pheno$tumor_stage.diagnoses == "stage iia"),7] <- "II"
pheno[which(pheno$tumor_stage.diagnoses == "stage iib"),7] <- "II"
pheno[which(pheno$tumor_stage.diagnoses == "stage iic"),7] <- "II"
table(pheno$tumor_stage.diagnoses)
pheno[which(pheno$tumor_stage.diagnoses == "stage iii"),7] <- "III"
pheno[which(pheno$tumor_stage.diagnoses == "stage iiia"),7] <- "III"
pheno[which(pheno$tumor_stage.diagnoses == "stage iiib"),7] <- "III"
pheno[which(pheno$tumor_stage.diagnoses == "stage iiic"),7] <- "III"
pheno[which(pheno$tumor_stage.diagnoses == "stage iv"),7] <- "IV"
pheno[which(pheno$tumor_stage.diagnoses == "stage iva"),7] <- "IV"
pheno[which(pheno$tumor_stage.diagnoses == "stage ivb"),7] <- "IV"
pheno[which(pheno$tumor_stage.diagnoses == "stage ivc"),7] <- "IV"
table(pheno$tumor_stage.diagnoses)

exp_sample <- colnames(luad)[-1]
surv_sample <- surv$sample
pheno_sample <- pheno$submitter_id.samples
jiaoji <- intersect(intersect(pheno_sample,surv_sample),exp_sample)

pheno1 <- pheno[which(pheno$submitter_id.samples %in% jiaoji),]
colnames(pheno1) <- c("sample_id","age","gender","M","N","T","stage")
luad <- tibble::column_to_rownames(luad,"Ensembl_ID")
luad1 <- luad[,jiaoji] 

surv1 <- surv[which(surv$sample %in% jiaoji),]

irg <- data.table::fread('D:/linshiwenjian/r-daima/免疫基因.txt')
irg <- irg[!duplicated(irg$Symbol),]
idmapping <- read.table(file = "lianxi/PMID32798715/gencode.v22.annotation.gene.probeMap", 
                        sep = "\t", header = T, stringsAsFactors = F)
geneid <- data.frame(id = rownames(luad1), stringsAsFactors = F)
geneid2symbol <- dplyr::left_join(geneid, idmapping, by = "id")
luad1$symbol <- geneid2symbol$gene
luad1 <- luad1[which(luad1$symbol %in% irg$Symbol),]
luad1 <- luad1[order(luad1$symbol),]
luad2 <- aggregate(luad1[,c(1:(ncol(luad1)-1))], 
                   by = list(luad1$symbol), mean)
rownames(luad2) <- luad2[,1]
luad2 <- luad2[,-1]
save(luad2,surv1,pheno1,file='D:/File/igpr/hnsc_yuanshuju.Rdata')

#PAAD
luad <- data.table::fread('lianxi/PMID32798715/PAAD/TCGA-PAAD.htseq_fpkm.tsv.gz')
surv <- data.table::fread('lianxi/PMID32798715/PAAD/TCGA-PAAD.survival.tsv.gz')
surv <- surv[,-3]
pheno <- data.table::fread('lianxi/PMID32798715/PAAD/TCGA-PAAD.GDC_phenotype.tsv.gz')
pheno <- pheno[which(pheno$sample_type.samples == 'Primary Tumor'),]
pheno <- pheno[,c("submitter_id.samples","age_at_initial_pathologic_diagnosis","gender.demographic","pathologic_M",
                  "pathologic_N","pathologic_T","tumor_stage.diagnoses")]
pheno <- na.omit(pheno)

table(pheno$pathologic_M)
pheno <- pheno[which(pheno$pathologic_M != ""),]
pheno[which(pheno$pathologic_M == "M1a"),4] <- "M1"
pheno[which(pheno$pathologic_M == "M1b"),4] <- "M1"
pheno[which(pheno$pathologic_M == "MX"),4] <- "M1"
pheno <- pheno[which(pheno$pathologic_M != "MX"),]
table(pheno$pathologic_M)

table(pheno$pathologic_N)
pheno <- pheno[which(pheno$pathologic_N != ""),]
pheno <- pheno[which(pheno$pathologic_N != "NX"),]
pheno[which(pheno$pathologic_N == "N1a"),5] <- "N1"
pheno[which(pheno$pathologic_N == "N1b"),5] <- "N1"
pheno[which(pheno$pathologic_N == "N1c"),5] <- "N1"
pheno[which(pheno$pathologic_N == "N2a"),5] <- "N2"
pheno[which(pheno$pathologic_N == "N2b"),5] <- "N2"
pheno[which(pheno$pathologic_N == "N2c"),5] <- "N2"
pheno[which(pheno$pathologic_N == "N3a"),5] <- "N3"
pheno[which(pheno$pathologic_N == "N3b"),5] <- "N3"
pheno[which(pheno$pathologic_N == "NX"),5] <- "N1"
table(pheno$pathologic_N)

table(pheno$pathologic_T)
pheno <- pheno[which(pheno$pathologic_T != ""),]
pheno <- pheno[which(pheno$pathologic_T != "TX"),]
pheno <- pheno[which(pheno$pathologic_T != "T0"),]
pheno[which(pheno$pathologic_T == "T1a"),6] <- "T1"
pheno[which(pheno$pathologic_T == "T1b"),6] <- "T1"
pheno[which(pheno$pathologic_T == "T2a"),6] <- "T2"
pheno[which(pheno$pathologic_T == "T2b"),6] <- "T2"
pheno[which(pheno$pathologic_T == "T3a"),6] <- "T3"
pheno[which(pheno$pathologic_T == "T3b"),6] <- "T3"
pheno[which(pheno$pathologic_T == "T4a"),6] <- "T4"
pheno[which(pheno$pathologic_T == "T4b"),6] <- "T4"
table(pheno$pathologic_T)

table(pheno$tumor_stage.diagnoses)
pheno <- pheno[which(pheno$tumor_stage.diagnoses != "not reported"),]
pheno[which(pheno$tumor_stage.diagnoses == "stage i"),7] <- "I"
pheno[which(pheno$tumor_stage.diagnoses == "stage ia"),7] <- "I"
pheno[which(pheno$tumor_stage.diagnoses == "stage ib"),7] <- "I"
table(pheno$tumor_stage.diagnoses)
pheno[which(pheno$tumor_stage.diagnoses == "stage ii"),7] <- "II"
pheno[which(pheno$tumor_stage.diagnoses == "stage iia"),7] <- "II"
pheno[which(pheno$tumor_stage.diagnoses == "stage iib"),7] <- "II"
pheno[which(pheno$tumor_stage.diagnoses == "stage iic"),7] <- "II"
table(pheno$tumor_stage.diagnoses)
pheno[which(pheno$tumor_stage.diagnoses == "stage iii"),7] <- "III"
pheno[which(pheno$tumor_stage.diagnoses == "stage iiia"),7] <- "III"
pheno[which(pheno$tumor_stage.diagnoses == "stage iiib"),7] <- "III"
pheno[which(pheno$tumor_stage.diagnoses == "stage iiic"),7] <- "III"
pheno[which(pheno$tumor_stage.diagnoses == "stage iv"),7] <- "IV"
pheno[which(pheno$tumor_stage.diagnoses == "stage iva"),7] <- "IV"
pheno[which(pheno$tumor_stage.diagnoses == "stage ivb"),7] <- "IV"
pheno[which(pheno$tumor_stage.diagnoses == "stage ivc"),7] <- "IV"
table(pheno$tumor_stage.diagnoses)

exp_sample <- colnames(luad)[-1]
surv_sample <- surv$sample
pheno_sample <- pheno$submitter_id.samples
jiaoji <- intersect(intersect(pheno_sample,surv_sample),exp_sample)

pheno1 <- pheno[which(pheno$submitter_id.samples %in% jiaoji),]
colnames(pheno1) <- c("sample_id","age","gender","M","N","T","stage")
luad <- tibble::column_to_rownames(luad,"Ensembl_ID")
luad1 <- luad[,jiaoji] 

surv1 <- surv[which(surv$sample %in% jiaoji),]

irg <- data.table::fread('D:/linshiwenjian/r-daima/免疫基因.txt')
irg <- irg[!duplicated(irg$Symbol),]
idmapping <- read.table(file = "lianxi/PMID32798715/gencode.v22.annotation.gene.probeMap", 
                        sep = "\t", header = T, stringsAsFactors = F)
geneid <- data.frame(id = rownames(luad1), stringsAsFactors = F)
geneid2symbol <- dplyr::left_join(geneid, idmapping, by = "id")
luad1$symbol <- geneid2symbol$gene
luad1 <- luad1[which(luad1$symbol %in% irg$Symbol),]
luad1 <- luad1[order(luad1$symbol),]
luad2 <- aggregate(luad1[,c(1:(ncol(luad1)-1))], 
                   by = list(luad1$symbol), mean)
rownames(luad2) <- luad2[,1]
luad2 <- luad2[,-1]
save(luad2,surv1,pheno1,file='D:/File/igpr/paad_yuanshuju.Rdata')

#LIHC
luad <- data.table::fread('lianxi/PMID32798715/LIHC/TCGA-LIHC.htseq_fpkm.tsv.gz')
surv <- data.table::fread('lianxi/PMID32798715/LIHC/TCGA-LIHC.survival.tsv.gz')
surv <- surv[,-3]
pheno <- data.table::fread('lianxi/PMID32798715/LIHC/TCGA-LIHC.GDC_phenotype.tsv.gz')
pheno <- pheno[which(pheno$sample_type.samples == 'Primary Tumor'),]
pheno <- pheno[,c("submitter_id.samples","age_at_initial_pathologic_diagnosis","gender.demographic","pathologic_M",
                  "pathologic_N","pathologic_T","tumor_stage.diagnoses")]
pheno <- na.omit(pheno)

table(pheno$pathologic_M)
pheno <- pheno[which(pheno$pathologic_M != ""),]
pheno[which(pheno$pathologic_M == "M1a"),4] <- "M1"
pheno[which(pheno$pathologic_M == "M1b"),4] <- "M1"
pheno[which(pheno$pathologic_M == "MX"),4] <- "M1"
pheno <- pheno[which(pheno$pathologic_M != "MX"),]
table(pheno$pathologic_M)

table(pheno$pathologic_N)
pheno <- pheno[which(pheno$pathologic_N != ""),]
pheno <- pheno[which(pheno$pathologic_N != "NX"),]
pheno[which(pheno$pathologic_N == "N1a"),5] <- "N1"
pheno[which(pheno$pathologic_N == "N1b"),5] <- "N1"
pheno[which(pheno$pathologic_N == "N1c"),5] <- "N1"
pheno[which(pheno$pathologic_N == "N2a"),5] <- "N2"
pheno[which(pheno$pathologic_N == "N2b"),5] <- "N2"
pheno[which(pheno$pathologic_N == "N2c"),5] <- "N2"
pheno[which(pheno$pathologic_N == "N3a"),5] <- "N3"
pheno[which(pheno$pathologic_N == "N3b"),5] <- "N3"
pheno[which(pheno$pathologic_N == "NX"),5] <- "N1"
table(pheno$pathologic_N)

table(pheno$pathologic_T)
pheno <- pheno[which(pheno$pathologic_T != ""),]
pheno <- pheno[which(pheno$pathologic_T != "TX"),]
pheno <- pheno[which(pheno$pathologic_T != "T0"),]
pheno[which(pheno$pathologic_T == "T1a"),6] <- "T1"
pheno[which(pheno$pathologic_T == "T1b"),6] <- "T1"
pheno[which(pheno$pathologic_T == "T2a"),6] <- "T2"
pheno[which(pheno$pathologic_T == "T2b"),6] <- "T2"
pheno[which(pheno$pathologic_T == "T3a"),6] <- "T3"
pheno[which(pheno$pathologic_T == "T3b"),6] <- "T3"
pheno[which(pheno$pathologic_T == "T4a"),6] <- "T4"
pheno[which(pheno$pathologic_T == "T4b"),6] <- "T4"
table(pheno$pathologic_T)

table(pheno$tumor_stage.diagnoses)
pheno <- pheno[which(pheno$tumor_stage.diagnoses != "not reported"),]
pheno[which(pheno$tumor_stage.diagnoses == "stage i"),7] <- "I"
pheno[which(pheno$tumor_stage.diagnoses == "stage ia"),7] <- "I"
pheno[which(pheno$tumor_stage.diagnoses == "stage ib"),7] <- "I"
table(pheno$tumor_stage.diagnoses)
pheno[which(pheno$tumor_stage.diagnoses == "stage ii"),7] <- "II"
pheno[which(pheno$tumor_stage.diagnoses == "stage iia"),7] <- "II"
pheno[which(pheno$tumor_stage.diagnoses == "stage iib"),7] <- "II"
pheno[which(pheno$tumor_stage.diagnoses == "stage iic"),7] <- "II"
table(pheno$tumor_stage.diagnoses)
pheno[which(pheno$tumor_stage.diagnoses == "stage iii"),7] <- "III"
pheno[which(pheno$tumor_stage.diagnoses == "stage iiia"),7] <- "III"
pheno[which(pheno$tumor_stage.diagnoses == "stage iiib"),7] <- "III"
pheno[which(pheno$tumor_stage.diagnoses == "stage iiic"),7] <- "III"
pheno[which(pheno$tumor_stage.diagnoses == "stage iv"),7] <- "IV"
pheno[which(pheno$tumor_stage.diagnoses == "stage iva"),7] <- "IV"
pheno[which(pheno$tumor_stage.diagnoses == "stage ivb"),7] <- "IV"
pheno[which(pheno$tumor_stage.diagnoses == "stage ivc"),7] <- "IV"
table(pheno$tumor_stage.diagnoses)

exp_sample <- colnames(luad)[-1]
surv_sample <- surv$sample
pheno_sample <- pheno$submitter_id.samples
jiaoji <- intersect(intersect(pheno_sample,surv_sample),exp_sample)

pheno1 <- pheno[which(pheno$submitter_id.samples %in% jiaoji),]
colnames(pheno1) <- c("sample_id","age","gender","M","N","T","stage")
luad <- tibble::column_to_rownames(luad,"Ensembl_ID")
luad1 <- luad[,jiaoji] 

surv1 <- surv[which(surv$sample %in% jiaoji),]

irg <- data.table::fread('D:/linshiwenjian/r-daima/免疫基因.txt')
irg <- irg[!duplicated(irg$Symbol),]
idmapping <- read.table(file = "lianxi/PMID32798715/gencode.v22.annotation.gene.probeMap", 
                        sep = "\t", header = T, stringsAsFactors = F)
geneid <- data.frame(id = rownames(luad1), stringsAsFactors = F)
geneid2symbol <- dplyr::left_join(geneid, idmapping, by = "id")
luad1$symbol <- geneid2symbol$gene
luad1 <- luad1[which(luad1$symbol %in% irg$Symbol),]
luad1 <- luad1[order(luad1$symbol),]
luad2 <- aggregate(luad1[,c(1:(ncol(luad1)-1))], 
                   by = list(luad1$symbol), mean)
rownames(luad2) <- luad2[,1]
luad2 <- luad2[,-1]
save(luad2,surv1,pheno1,file='D:/File/igpr/lihc_yuanshuju.Rdata')

#相同免疫基因对的表达数据
coad <- data.table::fread('D:/File/igpr/irgps/COAD/coad_irgps.txt')
esca <- data.table::fread('D:/File/igpr/irgps/ESCA/esca_irgps.txt')
read <- data.table::fread('D:/File/igpr/irgps/READ/read_irgps.txt')
stad <- data.table::fread('D:/File/igpr/irgps/STAD/stad_irgps.txt')
a <- intersect(coad$V1,esca$V1)
a <- intersect(a,read$V1)
a <- intersect(a,stad$V1)
coad <- tibble::column_to_rownames(coad,'V1')
esca <- tibble::column_to_rownames(esca,'V1')
read <- tibble::column_to_rownames(read,'V1')
stad <- tibble::column_to_rownames(stad,'V1')
coad <- coad[a,]
esca <- esca[a,]
read <- read[a,]
stad <- stad[a,]
data <- cbind(coad,esca)
data <- cbind(data,read)
data <- cbind(data,stad)
save(data,file = 'D:/File/igpr/irgps/total_biaoda.Rdata')
```

```R
#免疫基因对数据   生存数据
load('D:/File/igpr/irgps/COAD/coad_yuanshuju.Rdata')
coadsurv <- surv1
load('D:/File/igpr/irgps/ESCA/esca_yuanshuju.Rdata')
escasurv <- surv1
load('D:/File/igpr/irgps/READ/read_yuanshuju.Rdata')
readsurv <- surv1
load('D:/File/igpr/irgps/STAD/stad_yuanshuju.Rdata')
stadsurv <- surv1
load('D:/File/igpr/irgps/total_biaoda.Rdata')
coadsurv <- tibble::column_to_rownames(coadsurv,'sample')
escasurv <- tibble::column_to_rownames(escasurv,'sample')
readsurv <- tibble::column_to_rownames(readsurv,'sample')
stadsurv <- tibble::column_to_rownames(stadsurv,'sample')
coad <- colnames(data)[1:389]
coadsurv <- coadsurv[coad,]
esca <- colnames(data)[390:515]
escasurv <- escasurv[esca,]
read <- colnames(data)[516:653]
readsurv <- readsurv[read,]
stad <- colnames(data)[654:967]
stadsurv <- stadsurv[stad,]
surv <- rbind(coadsurv,escasurv)
surv <- rbind(surv,readsurv)
surv <- rbind(surv,stadsurv)
data <- as.data.frame(t(data))
save(data,surv,file='D:/File/igpr/irgps/total_biaoda_surv.Rdata')

```

## 多组学生存数据

```R
#提取os,dss,pfi三种生存数据，再筛选出肿瘤样本
coadsurv <- data.table::fread('D:/File/igpr/survival%2FCOAD_survival.txt.gz')
escasurv <- data.table::fread('D:/File/igpr/survival%2FESCA_survival.txt.gz')
readsurv <- data.table::fread('D:/File/igpr/survival%2FREAD_survival.txt.gz')
stadsurv <- data.table::fread('D:/File/igpr/survival%2FSTAD_survival.txt.gz')
coadsurv <- coadsurv[,c(-2,-7,-8,-11)]
escasurv <- escasurv[,c(-2,-7,-8,-11)]
readsurv <- readsurv[,c(-2,-7,-8,-11)]
stadsurv <- stadsurv[,c(-2,-7,-8,-11)]
colnames(coadsurv) <- c('sample','osstat','ostime',
                        'dsstat','dsstime','pfistat','pfitime')
colnames(escasurv) <- c('sample','osstat','ostime',
                        'dsstat','dsstime','pfistat','pfitime')
colnames(readsurv) <- c('sample','osstat','ostime',
                        'dsstat','dsstime','pfistat','pfitime')
colnames(stadsurv) <- c('sample','osstat','ostime',
                        'dsstat','dsstime','pfistat','pfitime')
coados <- coadsurv[,c(1,2,3)]
coaddss <- coadsurv[,c(1,4,5)]
coadpfi <- coadsurv[,c(1,6,7)]
coados <- na.omit(coados)
coaddss <- na.omit(coaddss)
coadpfi <- na.omit(coadpfi)

escaos <- escasurv[,c(1,2,3)]
escadss <- escasurv[,c(1,4,5)]
escapfi <- escasurv[,c(1,6,7)]
escaos <- na.omit(escaos)
escadss <- na.omit(escadss)
escapfi <- na.omit(escapfi)

reados <- readsurv[,c(1,2,3)]
readdss <- readsurv[,c(1,4,5)]
readpfi <- readsurv[,c(1,6,7)]
reados <- na.omit(reados)
readdss <- na.omit(readdss)
readpfi <- na.omit(readpfi)

stados <- stadsurv[,c(1,2,3)]
staddss <- stadsurv[,c(1,4,5)]
stadpfi <- stadsurv[,c(1,6,7)]
stados <- na.omit(stados)
staddss <- na.omit(staddss)
stadpfi <- na.omit(stadpfi)
save(coados,coaddss,coadpfi,escaos,escadss,escapfi,
     reados,readdss,readpfi,stados,staddss,stadpfi,
     file = 'D:/File/igpr/shengcunshuju.Rdata')

coadpheo <- data.table::fread('D:/File/igpr/TCGA.COAD.sampleMap%2FCOAD_clinicalMatrix')
coadpheo <- coadpheo[,c('sampleID','sample_type')]
coadpheoc <- coadpheo[which(coadpheo$sample_type=='Primary Tumor'),]

readpheo <- data.table::fread('D:/File/igpr/TCGA.READ.sampleMap%2FREAD_clinicalMatrix')
readpheo <- readpheo[,c('sampleID','sample_type')]
readpheoc <- readpheo[which(readpheo$sample_type=='Primary Tumor'),]

escapheo <- data.table::fread('D:/File/igpr/TCGA.ESCA.sampleMap%2FESCA_clinicalMatrix')
escapheo <- escapheo[,c('sampleID','sample_type')]
escapheoc <- escapheo[which(escapheo$sample_type=='Primary Tumor'),]

stadpheo <- data.table::fread('D:/File/igpr/TCGA.STAD.sampleMap%2FSTAD_clinicalMatrix')
stadpheo <- stadpheo[,c('sampleID','sample_type')]
stadpheoc <- stadpheo[which(stadpheo$sample_type=='Primary Tumor'),]

load('D:/File/igpr/shengcunshuju.Rdata')
coados <- coados[which(coados$sample %in% intersect(coadpheoc$sampleID,coados$sample)),]
coaddss <- coaddss[which(coaddss$sample %in% intersect(coadpheoc$sampleID,coaddss$sample)),]
coadpfi <- coadpfi[which(coadpfi$sample %in% intersect(coadpheoc$sampleID,coadpfi$sample)),]

escaos <- escaos[which(escaos$sample %in% intersect(escapheoc$sampleID,escaos$sample)),]
escadss <- escadss[which(escadss$sample %in% intersect(escapheoc$sampleID,escadss$sample)),]
escapfi <- escapfi[which(escapfi$sample %in% intersect(escapheoc$sampleID,escapfi$sample)),]

reados <- reados[which(reados$sample %in% intersect(readpheoc$sampleID,reados$sample)),]
readdss <- readdss[which(readdss$sample %in% intersect(readpheoc$sampleID,readdss$sample)),]
readpfi <- readpfi[which(readpfi$sample %in% intersect(readpheoc$sampleID,readpfi$sample)),]

stados <- stados[which(stados$sample %in% intersect(stadpheoc$sampleID,stados$sample)),]
staddss <- staddss[which(staddss$sample %in% intersect(stadpheoc$sampleID,staddss$sample)),]
stadpfi <- stadpfi[which(stadpfi$sample %in% intersect(stadpheoc$sampleID,stadpfi$sample)),]
save(coados,coaddss,coadpfi,escaos,escadss,escapfi,
     reados,readdss,readpfi,stados,staddss,stadpfi,
     file = 'D:/File/igpr/shengcunshuju.Rdata')
```

## 提取五年生存的表达与生存数据

```R
#提取五年生存的表达与生存数据
load('D:/File/igpr/esca_biaodashuju.Rdata')
load('D:/File/igpr/coad_biaodashuju.Rdata')
load('D:/File/igpr/read_biaodashuju.Rdata')
load('D:/File/igpr/stad_biaodashuju.Rdata')
load('D:/File/igpr/shengcunshuju.Rdata')
a <- intersect(intersect(colnames(coadmrna),
                         colnames(coadmirna)),colnames(coadmethy))
coad <- rbind(rbind(coadmrna[,a],coadmirna[,a]),coadmethy[,a])
coad <- as.data.frame(t(coad))
b <- intersect(intersect(colnames(escamrna),
                         colnames(escamirna)),colnames(escamethy))
esca <- rbind(rbind(escamrna[,b],escamirna[,b]),escamethy[,b])
esca <- as.data.frame(t(esca))
c <- intersect(intersect(colnames(readmrna),
                        colnames(readmirna)),colnames(readmethy))
read <- rbind(rbind(readmrna[,c],readmirna[,c]),readmethy[,c])
read <- as.data.frame(t(read))
d <- intersect(intersect(colnames(stadmrna),
                         colnames(stadmirna)),colnames(stadmethy))
stad <- rbind(rbind(stadmrna[,d],stadmirna[,d]),stadmethy[,d])
stad <- as.data.frame(t(stad))

coados <- tibble::column_to_rownames(coados,'sample')
escaos <- tibble::column_to_rownames(escaos,'sample')
reados <- tibble::column_to_rownames(reados,'sample')
stados <- tibble::column_to_rownames(stados,'sample')
coaddss <- tibble::column_to_rownames(coaddss,'sample')
escadss <- tibble::column_to_rownames(escadss,'sample')
readdss <- tibble::column_to_rownames(readdss,'sample')
staddss <- tibble::column_to_rownames(staddss,'sample')
coadpfi <- tibble::column_to_rownames(coadpfi,'sample')
escapfi <- tibble::column_to_rownames(escapfi,'sample')
readpfi <- tibble::column_to_rownames(readpfi,'sample')
stadpfi <- tibble::column_to_rownames(stadpfi,'sample')

coados5 <- coados[which(coados$ostime < 365*5),]
escaos5 <- escaos[which(escaos$ostime < 365*5),]
reados5 <- reados[which(reados$ostime < 365*5),]
stados5 <- stados[which(stados$ostime < 365*5),]

coadDataos5 <- cbind(coad[intersect(rownames(coad),rownames(coados5)),],
                     coados5[intersect(rownames(coad),rownames(coados5)),])
coadDataos5 <- coadDataos5[,-ncol(coadDataos5)]
escaDataos5 <- cbind(esca[intersect(rownames(esca),rownames(escaos5)),],
                     escaos5[intersect(rownames(esca),rownames(escaos5)),])
escaDataos5 <- escaDataos5[,-ncol(escaDataos5)]
readDataos5 <- cbind(read[intersect(rownames(read),rownames(reados5)),],
                     reados5[intersect(rownames(read),rownames(reados5)),])
readDataos5 <- readDataos5[,-ncol(readDataos5)]
stadDataos5 <- cbind(stad[intersect(rownames(stad),rownames(stados5)),],
                     stados5[intersect(rownames(stad),rownames(stados5)),])
stadDataos5 <- stadDataos5[,-ncol(stadDataos5)]

tzos <- intersect(intersect(intersect(colnames(coadDataos5),
                                      colnames(escaDataos5)),colnames(readDataos5)),colnames(stadDataos5))
dataos5 <- rbind(coadDataos5[,tzos],escaDataos5[,tzos])
dataos5 <- rbind(dataos5,readDataos5[,tzos])
dataos5 <- rbind(dataos5,stadDataos5[,tzos])


coaddss5 <- coaddss[which(coaddss$dsstime < 365*5),]
escadss5 <- escadss[which(escadss$dsstime < 365*5),]
readdss5 <- readdss[which(readdss$dsstime < 365*5),]
staddss5 <- staddss[which(staddss$dsstime < 365*5),]

coadDatadss5 <- cbind(coad[intersect(rownames(coad),rownames(coaddss5)),],
                     coaddss5[intersect(rownames(coad),rownames(coaddss5)),])
coadDatadss5 <- coadDatadss5[,-ncol(coadDatadss5)]
escaDatadss5 <- cbind(esca[intersect(rownames(esca),rownames(escadss5)),],
                     escadss5[intersect(rownames(esca),rownames(escadss5)),])
escaDatadss5 <- escaDatadss5[,-ncol(escaDatadss5)]
readDatadss5 <- cbind(read[intersect(rownames(read),rownames(readdss5)),],
                     readdss5[intersect(rownames(read),rownames(readdss5)),])
readDatadss5 <- readDatadss5[,-ncol(readDatadss5)]
stadDatadss5 <- cbind(stad[intersect(rownames(stad),rownames(staddss5)),],
                     staddss5[intersect(rownames(stad),rownames(staddss5)),])
stadDatadss5 <- stadDatadss5[,-ncol(stadDatadss5)]

tzdss <- intersect(intersect(intersect(colnames(coadDatadss5),
  colnames(escaDatadss5)),colnames(readDatadss5)),colnames(stadDatadss5))
datadss5 <- rbind(coadDatadss5[,tzdss],escaDatadss5[,tzdss])
datadss5 <- rbind(datadss5,readDatadss5[,tzdss])
datadss5 <- rbind(datadss5,stadDatadss5[,tzdss])



#PFI
coadpfi5 <- coadpfi[which(coadpfi$pfitime < 365*5),]
escapfi5 <- escapfi[which(escapfi$pfitime < 365*5),]
readpfi5 <- readpfi[which(readpfi$pfitime < 365*5),]
stadpfi5 <- stadpfi[which(stadpfi$pfitime < 365*5),]

coadDatapfi5 <- cbind(coad[intersect(rownames(coad),rownames(coadpfi5)),],
                     coadpfi5[intersect(rownames(coad),rownames(coadpfi5)),])
coadDatapfi5 <- coadDatapfi5[,-ncol(coadDatapfi5)]
escaDatapfi5 <- cbind(esca[intersect(rownames(esca),rownames(escapfi5)),],
                     escapfi5[intersect(rownames(esca),rownames(escapfi5)),])
escaDatapfi5 <- escaDatapfi5[,-ncol(escaDatapfi5)]
readDatapfi5 <- cbind(read[intersect(rownames(read),rownames(readpfi5)),],
                     readpfi5[intersect(rownames(read),rownames(readpfi5)),])
readDatapfi5 <- readDatapfi5[,-ncol(readDatapfi5)]
stadDatapfi5 <- cbind(stad[intersect(rownames(stad),rownames(stadpfi5)),],
                     stadpfi5[intersect(rownames(stad),rownames(stadpfi5)),])
stadDatapfi5 <- stadDatapfi5[,-ncol(stadDatapfi5)]

tzpfi <- intersect(intersect(intersect(colnames(coadDatapfi5),
  colnames(escaDatapfi5)),colnames(readDatapfi5)),colnames(stadDatapfi5))
datapfi5 <- rbind(coadDatapfi5[,tzpfi],escaDatapfi5[,tzpfi])
datapfi5 <- rbind(datapfi5,readDatapfi5[,tzpfi])
datapfi5 <- rbind(datapfi5,stadDatapfi5[,tzpfi])

save(dataos5,datadss5,datapfi5,file = 'D:/File/igpr/irgps/fiveyear.Rdata')
```

## 从诊断到死亡

```R
#从诊断到死亡
coadosd <- coados[which(coados$osstat == 1),]
escaosd <- escaos[which(escaos$osstat == 1),]
readosd <- reados[which(reados$osstat == 1),]
stadosd <- stados[which(stados$osstat == 1),]
coadDataosd <- cbind(coad[intersect(rownames(coad),rownames(coadosd)),],
                     coadosd[intersect(rownames(coad),rownames(coadosd)),])
coadDataosd <- coadDataosd[,-ncol(coadDataosd)]
escaDataosd <- cbind(esca[intersect(rownames(esca),rownames(escaosd)),],
                     escaosd[intersect(rownames(esca),rownames(escaosd)),])
escaDataosd <- escaDataosd[,-ncol(escaDataosd)]
readDataosd <- cbind(read[intersect(rownames(read),rownames(readosd)),],
                     readosd[intersect(rownames(read),rownames(readosd)),])
readDataosd <- readDataosd[,-ncol(readDataosd)]
stadDataosd <- cbind(stad[intersect(rownames(stad),rownames(stadosd)),],
                     stadosd[intersect(rownames(stad),rownames(stadosd)),])
stadDataosd <- stadDataosd[,-ncol(stadDataosd)]

tzos <- intersect(intersect(intersect(colnames(coadDataosd),
                                      colnames(escaDataosd)),colnames(readDataosd)),colnames(stadDataosd))
dataosd <- rbind(coadDataosd[,tzos],escaDataosd[,tzos])
dataosd <- rbind(dataosd,readDataosd[,tzos])
dataosd <- rbind(dataosd,stadDataosd[,tzos])

coaddssd <- coaddss[which(coaddss$dsstat == 1),]
escadssd <- escadss[which(escadss$dsstat == 1),]
readdssd <- readdss[which(readdss$dsstat == 1),]
staddssd <- staddss[which(staddss$dsstat == 1),]
coadDatadssd <- cbind(coad[intersect(rownames(coad),rownames(coaddssd)),],
                     coaddssd[intersect(rownames(coad),rownames(coaddssd)),])
coadDatadssd <- coadDatadssd[,-ncol(coadDatadssd)]
escaDatadssd <- cbind(esca[intersect(rownames(esca),rownames(escadssd)),],
                     escadssd[intersect(rownames(esca),rownames(escadssd)),])
escaDatadssd <- escaDatadssd[,-ncol(escaDatadssd)]
readDatadssd <- cbind(read[intersect(rownames(read),rownames(readdssd)),],
                     readdssd[intersect(rownames(read),rownames(readdssd)),])
readDatadssd <- readDatadssd[,-ncol(readDatadssd)]
stadDatadssd <- cbind(stad[intersect(rownames(stad),rownames(staddssd)),],
                     staddssd[intersect(rownames(stad),rownames(staddssd)),])
stadDatadssd <- stadDatadssd[,-ncol(stadDatadssd)]

tzdss <- intersect(intersect(intersect(colnames(coadDatadssd),
                                      colnames(escaDatadssd)),colnames(readDatadssd)),colnames(stadDatadssd))
datadssd <- rbind(coadDatadssd[,tzdss],escaDatadssd[,tzdss])
datadssd <- rbind(datadssd,readDatadssd[,tzdss])
datadssd <- rbind(datadssd,stadDatadssd[,tzdss])


coadpfid <- coadpfi[which(coadpfi$pfistat == 1),]
escapfid <- escapfi[which(escapfi$pfistat == 1),]
readpfid <- readpfi[which(readpfi$pfistat == 1),]
stadpfid <- stadpfi[which(stadpfi$pfistat == 1),]
coadDatapfid <- cbind(coad[intersect(rownames(coad),rownames(coadpfid)),],
                     coadpfid[intersect(rownames(coad),rownames(coadpfid)),])
coadDatapfid <- coadDatapfid[,-ncol(coadDatapfid)]
escaDatapfid <- cbind(esca[intersect(rownames(esca),rownames(escapfid)),],
                     escapfid[intersect(rownames(esca),rownames(escapfid)),])
escaDatapfid <- escaDatapfid[,-ncol(escaDatapfid)]
readDatapfid <- cbind(read[intersect(rownames(read),rownames(readpfid)),],
                     readpfid[intersect(rownames(read),rownames(readpfid)),])
readDatapfid <- readDatapfid[,-ncol(readDatapfid)]
stadDatapfid <- cbind(stad[intersect(rownames(stad),rownames(stadpfid)),],
                     stadpfid[intersect(rownames(stad),rownames(stadpfid)),])
stadDatapfid <- stadDatapfid[,-ncol(stadDatapfid)]

tzpfi <- intersect(intersect(intersect(colnames(coadDatapfid),
                                colnames(escaDatapfid)),colnames(readDatapfid)),colnames(stadDatapfid))
datapfid <- rbind(coadDatapfid[,tzpfi],escaDatapfid[,tzpfi])
datapfid <- rbind(datapfid,readDatapfid[,tzpfi])
datapfid <- rbind(datapfid,stadDatapfid[,tzpfi])
save(dataosd,datadssd,datapfid,file = 'D:/File/igpr/irgps/diagTodeath.Rdata')
```

## 提取coxnnet数据

```R
load('D:/File/igpr/coadread_multiomics.Rdata')
load('D:/File/igpr/esca_multiomics.Rdata')
load('D:/File/igpr/stad_multiomics.Rdata')
load('D:/File/igpr/paad_multiomics.Rdata')
load('D:/File/igpr/lihc_multiomics.Rdata')
load('D:/File/igpr/hnsc_multiomics.Rdata')
stadmr <- as.data.frame(t(stadmrna))
stados <- stadcli[,c(1,2)]
stados <- na.omit(stados)
a <- as.data.frame(substring(rownames(stados),first = 14,last = 15))
colnames(a) <- 'type'
stados <- cbind(stados,a)
stadosc <- stados[which(stados$type!='11'),]
stadmr <- stadmr[intersect(rownames(stadmr),rownames(stadosc)),]
stados <- stados[intersect(rownames(stadmr),rownames(stadosc)),]
write.csv(stados[,1],file = 'D:/File/igpr/coxnnetData/stadstat.csv',row.names = F)
write.csv(stados[,2],file = 'D:/File/igpr/coxnnetData/stadtime.csv',row.names = F)
write.csv(stadmr,file = 'D:/File/igpr/coxnnetData/stadmr.csv',row.names = F)
options(stringsAsFactors = F)
```



## WSI肿瘤与正常的配对样本

```R
coadTS <- read.csv('D:/File/wsi/下载数据文件/coadTS.csv')
coadTS <- coadTS[,c(2,4,6)]
coadTSn <- coadTS[which(coadTS$Sample.Type=='Solid Tissue Normal'),]
coadTSn <- coadTSn[order(coadTSn$jie),]
coadTSc <- coadTS[which(coadTS$Sample.Type=='Primary Tumor'),]
coadTSc <- coadTSc[order(coadTSc$jie),]
coadT <- cbind(coadTSn,coadTSc)
colnames(coadT) <- c('filenor','nor','normal','filecan','can','cancer')

coadBS <- read.csv('D:/File/wsi/下载数据文件/coadBS.csv')
coadBS <- coadBS[,c(2,5,6)]
coadBSn <- coadBS[which(coadBS$Sample.Type=='Solid Tissue Normal'),]
coadBSn <- coadBSn[order(coadBSn$jie),]
coadBSc <- coadBS[which(coadBS$Sample.Type=='Primary Tumor'),]
coadBSc <- coadBSc[order(coadBSc$jie),]
coadB <- cbind(coadBSn,coadBSc)
colnames(coadB) <- c('filenor','normal','nor','filecan','cancer','can')

escaTS <- read.csv('D:/File/wsi/下载数据文件/escaTS.csv')
escaTS <- escaTS[,c(2,3,6)]
escaTSn <- escaTS[which(escaTS$Sample.Type=='Solid Tissue Normal'),]
escaTSn <- escaTSn[order(escaTSn$jie),]
escaTSc <- escaTS[which(escaTS$Sample.Type=='Primary Tumor'),]
escaTSc <- escaTSc[order(escaTSc$jie),]
identical(escaTSc$jie,escaTSn$jie)
escaT <- cbind(escaTSn,escaTSc)
colnames(escaT) <- c('filenor','nor','normal','filecan','can','cancer')

hnscTS <- read.csv('D:/File/wsi/下载数据文件/hnscTS.csv')
hnscTS <- hnscTS[,c(2,3,6)]
hnscTSn <- hnscTS[which(hnscTS$Sample.Type=='Solid Tissue Normal'),]
hnscTSn <- hnscTSn[order(hnscTSn$jie),]
hnscTSc <- hnscTS[which(hnscTS$Sample.Type=='Primary Tumor'),]
hnscTSc <- hnscTSc[order(hnscTSc$jie),]
identical(hnscTSc$jie,hnscTSn$jie)
hnscT <- cbind(hnscTSn,hnscTSc)
colnames(hnscT) <- c('filenor','nor','normal','filecan','can','cancer')

lihcTS <- read.csv('D:/File/wsi/下载数据文件/lihcTS.csv')
lihcTS <- lihcTS[,c(2,3,6)]
lihcTSn <- lihcTS[which(lihcTS$Sample.Type=='Solid Tissue Normal'),]
lihcTSn <- lihcTSn[order(lihcTSn$jie),]
lihcTSc <- lihcTS[which(lihcTS$Sample.Type=='Primary Tumor'),]
lihcTSc <- lihcTSc[order(lihcTSc$jie),]
identical(lihcTSc$jie,lihcTSn$jie)
lihcT <- cbind(lihcTSn,lihcTSc)
colnames(lihcT) <- c('filenor','nor','normal','filecan','can','cancer')

paadTS <- read.csv('D:/File/wsi/下载数据文件/paadTS.csv')
paadTS <- paadTS[,c(2,3,6)]
paadTSn <- paadTS[which(paadTS$Sample.Type=='Solid Tissue Normal'),]
paadTSn <- paadTSn[order(paadTSn$jie),]
paadTSc <- paadTS[which(paadTS$Sample.Type=='Primary Tumor'),]
paadTSc <- paadTSc[order(paadTSc$jie),]
identical(paadTSc$jie,paadTSn$jie)
paadT <- cbind(paadTSn,paadTSc)
colnames(paadT) <- c('filenor','nor','normal','filecan','can','cancer')

readTS <- read.csv('D:/File/wsi/下载数据文件/readTS.csv')
readTS <- readTS[,c(2,5,6)]
readTSn <- readTS[which(readTS$Sample.Type=='Solid Tissue Normal'),]
readTSn <- readTSn[order(readTSn$jie),]
readTSc <- readTS[which(readTS$Sample.Type=='Primary Tumor'),]
readTSc <- readTSc[order(readTSc$jie),]
identical(readTSc$jie,readTSn$jie)
readT <- cbind(readTSn,readTSc)
colnames(readT) <- c('filenor','normal','nor','filecan','cancer','can')

stadTS <- read.csv('D:/File/wsi/下载数据文件/stadTS.csv')
stadTS <- stadTS[,c(2,5,6)]
stadTSn <- stadTS[which(stadTS$Sample.Type=='Solid Tissue Normal'),]
stadTSn <- stadTSn[order(stadTSn$jie),]
stadTSc <- stadTS[which(stadTS$Sample.Type=='Primary Tumor'),]
stadTSc <- stadTSc[order(stadTSc$jie),]
identical(stadTSc$jie,stadTSn$jie)
stadT <- cbind(stadTSn,stadTSc)
colnames(stadT) <- c('filenor','normal','nor','filecan','cancer','can')

readBS <- read.csv('D:/File/wsi/下载数据文件/readBS.csv')
readBS <- readBS[,c(2,6,7)]
readBSn <- readBS[which(readBS$Sample.Type=='Solid Tissue Normal'),]
readBSn <- readBSn[order(readBSn$jie),]
readBSc <- readBS[which(readBS$Sample.Type=='Primary Tumor'),]
readBSc <- readBSc[order(readBSc$jie),]
identical(readBSc$jie,readBSn$jie)
readB <- cbind(readBSn,readBSc)
colnames(readB) <- c('filenor','normal','nor','filecan','cancer','can')

stadBS <- read.csv('D:/File/wsi/下载数据文件/stadBS.csv')
stadBS <- stadBS[,c(2,5,6)]
stadBSn <- stadBS[which(stadBS$Sample.Type=='Solid Tissue Normal'),]
stadBSn <- stadBSn[order(stadBSn$jie),]
stadBSc <- stadBS[which(stadBS$Sample.Type=='Primary Tumor'),]
stadBSc <- stadBSc[order(stadBSc$jie),]
identical(stadBSc$jie,stadBSn$jie)
stadB <- cbind(stadBSn,stadBSc)
colnames(stadB) <- c('filenor','normal','nor','filecan','cancer','can')
save(coadB,readB,stadB,coadT,escaT,readT,stadT,paadT,lihcT,hnscT,
     file='D:/File/wsi/下载数据文件/can_nor_peidui.Rdata')


#train,test,validation
load('D:/File/wsi/下载数据文件/can_nor_peidui.Rdata')
set.seed(0)
lihcT <- lihcT[,c('filenor','normal','nor','filecan','cancer','can')]
coadT <- coadT[,c('filenor','normal','nor','filecan','cancer','can')]
escaT <- escaT[,c('filenor','normal','nor','filecan','cancer','can')]
paadT <- paadT[,c('filenor','normal','nor','filecan','cancer','can')]
coadB <- coadB[sample(nrow(coadB)),]#9 5 3
coadBtr <- coadB[1:9,]
coadBte <- coadB[10:14,]
coadBva <- coadB[15:17,]
coadT <- coadT[sample(nrow(coadT)),]#36 15 12
coadTtr <- coadT[1:36,]
coadTte <- coadT[37:51,]
coadTva <- coadT[52:63,]
escaT <- escaT[sample(nrow(escaT)),]#30 11 10
escaTtr <- escaT[1:30,]
escaTte <- escaT[31:41,]
escaTva <- escaT[42:51,]
hnscT <- hnscT[sample(nrow(hnscT)),]#36 15 12
hnscTtr <- hnscT[1:27,]
hnscTte <- hnscT[28:39,]
hnscTva <- hnscT[40:48,]
lihcT <- lihcT[sample(nrow(lihcT)),]#39 13 13
lihcTtr <- lihcT[1:39,]
lihcTte <- lihcT[40:52,]
lihcTva <- lihcT[53:65,]
paadT <- paadT[sample(nrow(paadT)),]#12 5 4
paadTtr <- paadT[1:12,]
paadTte <- paadT[13:17,]
paadTva <- paadT[18:21,]
readB <- readB[sample(nrow(readB)),]#3 1 1
readBtr <- readB[1:3,]
readBte <- readB[4:4,]
readBva <- readB[5:5,]
readT <- readT[sample(nrow(readT)),]#8 3 3
readTtr <- readT[1:8,]
readTte <- readT[9:11,]
readTva <- readT[12:14,]
stadB <- stadB[sample(nrow(stadB)),]#15 6 5
stadBtr <- stadB[1:15,]
stadBte <- stadB[16:21,]
stadBva <- stadB[22:26,]
stadT <- stadT[sample(nrow(stadT)),]#49 17 17
stadTtr <- stadT[1:49,]
stadTte <- stadT[50:66,]
stadTva <- stadT[67:83,]

train <- rbind(coadBtr,escaTtr)
train <- rbind(train,hnscTtr)
train <- rbind(train,readBtr)
train <- rbind(train,lihcTtr)
train <- rbind(train,coadTtr)
train <- rbind(train,stadBtr)
train <- rbind(train,paadTtr)
train <- rbind(train,readTtr)
train <- rbind(train,stadTtr)

test <- rbind(coadBte,escaTte)
test <- rbind(test,hnscTte)
test <- rbind(test,readBte)
test <- rbind(test,lihcTte)
test <- rbind(test,coadTte)
test <- rbind(test,stadBte)
test <- rbind(test,paadTte)
test <- rbind(test,readTte)
test <- rbind(test,stadTte)

validate <- rbind(coadBva,escaTva)
validate <- rbind(validate,hnscTva)
validate <- rbind(validate,readBva)
validate <- rbind(validate,lihcTva)
validate <- rbind(validate,coadTva)
validate <- rbind(validate,stadBva)
validate <- rbind(validate,paadTva)
validate <- rbind(validate,readTva)
validate <- rbind(validate,stadTva)

data <- rbind(train,test)
data <- rbind(data,validate)
save(train,test,validate,data,
     file='D:/File/wsi/下载数据文件/can_nor_peidui_TrTeVaAll.Rdata')
```



## 算法时间复杂度

![Error](https://github.com/bigone1/test/blob/master/Screenshots/37.png)

## eQTL

首先QTL是数量性状位点，比如身高是一个数量性状，其对应的控制基因的位点就是一个数量性状位点，而eQTL就是控制数量性状表达位点，即能控制数量性状基因（如身高基因）表达水平高低的那些基因的位点。

数量性状基因座：控制数量性状的基因在基因组中的位置称为数量性状基因座。

表达数量性状基因座（eQTL）指染色体上一些能特定调控mRNA和蛋白质表达水平的区域，其mRNA/蛋白质的表达水平与数量性状成比例关系。eQTL可分为顺式作用eQTL和反式作用eQTL，顺式作用就是某个基因的eQTL定位到该基因所在的基因组区域，表明可能是该基因本身的差别引起的mRNA水平变化；反式作用指某个基因的eQTL定位到其他基因组区域，表明其他基因的差别控制该基因mRNA水平的差别。

eQTL就是把基因表达作为一种性状，研究遗传突变与基因表达的相关性。

与单个基因mRNA表达量相关的DNA突变，就被称为eQTL。

## 批次效应

**批次效应**，一般存在于要合并/比较分析的数据中。举几个例子：

1、两家不同的医院搜集样本检测得到的数据

2、同一家医院不同时间送去测序得到的数据

3、同一批样本，分两次测序得到的数据

4、用不同的测序平台得到的数据

## 判别式模型和生成式模型

判别式模型 (Discriminative Model)：直接对条件概率p(y|x)进行建模，常见判
别模型有：线性回归、决策树、支持向量机SVM、k近邻、神经网络等；
		生成式模型 (Generative Model)：对联合分布概率p(x,y)进行建模，常见生成式
模型有：隐马尔可夫模型HMM、朴素贝叶斯模型、高斯混合模型GMM、LDA等；

## 肿瘤免疫治疗

肿瘤免疫治疗主要分为两种：细胞免疫治疗和免疫检查点抑制剂治疗。

**细胞免疫疗法**：把患者体内免疫细胞拿到体外进行改造，让这些细胞具备对癌细胞更有效、更精准的免疫能力，改造后的免疫细胞回输到患者体内后，它们会定向消灭癌细胞。 **免疫检查点抑制剂**：通俗的说，免疫细胞会产生抑制自身的蛋白小分子。肿瘤细胞利用这种机制，抑制免疫细胞，从人体免疫系统中逃脱存活下来。免疫检查点抑制剂类药物，可解除这种抑制作用，让免疫细胞重新激活工作，消灭癌细胞。

**Analysis of immune-related signatures of lung adenocarcinoma identified two distinct subtypes: implications for immune checkpoint blockade therapy**

**通过分析肺腺癌免疫相关免疫特征确定两个亚型****：免疫检查点阻断治疗的意义**

- PD-1/PD-L1是主要的免疫检查点之一，有抑制免疫系统的作用，因而作用于PD-1/PD-L1的面积检查点抑制技术（ICB）可以激活T细胞，逆转免疫微环境的抑制状态，减少肿瘤细胞免疫逃逸。PD-L1表达水平与ICB治疗效果正相关。
- 肿瘤突变负荷（TMB）与ICB治疗效果正相关。
- TIDE算法使用基因标志物对两个免疫逃逸机制——CTL失活和阻止CTL浸润进行评估，高TIDE评分表示肿瘤免疫逃避概率大，ICB治疗效果差。

![Error](https://github.com/bigone1/test/blob/master/Screenshots/22.png)

##### 1.LUAD有预后差异的亚型鉴定

作者在TCGA泛癌免疫文件中基于11篇免疫相关文章收集了2995个免疫相关基因。使用单因素Cox回归分析，以FDR<0.05为标准筛选到了433个OS相关基因。使用R包“NMF”对433个基因进行一致性聚类分析，1A为*Cophenetic*相关系数，离差，轮廓系数与聚类数的关系，n=2时聚类效果最好，因此分为两个亚型，使用R包“survival”对两个亚型进行生存分析，1B为两组的KM生存曲线，结果显示两组的生存差异显著，分别标记为高风险组与低风险组。1C为各因素与OS间的多因素分析森林图，排除年龄，性别，吸烟，肿瘤分期等临床变量影响后，高低风险分组可作为病人预后的独立影响因素。

![Error](https://github.com/bigone1/test/blob/master/Screenshots/23.jpg)

为验证结果准确性，在9个验证集中再次使用上述433个免疫相关基因进行一致性聚类分析，做出生存曲线。结果显示，9个验证集被分为同样的2个亚型，且两组的生存差异显著，HR range: 1.69 [95% CI: 1.29-2.21, Log rank *P* < 0.001] to  4.29 [95% CI: 2.14-8.65, Log rank *P* < 0.001]

![Error](https://github.com/bigone1/test/blob/master/Screenshots/24.jpg)

##### 2.两亚型的ICB治疗效果预测

作者使用TIDE算法，对TCGA LUAD 数据集中两个亚型进行评分，3A为两组TIDE得分的箱线图，高风险组TIDE评分显著低于低风险组，多因素分析森林图3B显示排除年龄，性别，吸烟，肿瘤分期等临床变量影响后，结果仍有统计学意义。使用同样的方法，在9个验证集进行检验，结果一致(3C)，表明高风险组病人对ICB治疗可能更敏感。

![Error](https://github.com/bigone1/test/blob/master/Screenshots/25.jpg)

##### 3.两亚型PD-L1表达与TMB差异

作者比较了高低风险组PD-L1表达水平，4A,B为PD-L1在TCGA与验证集中表达水平的箱线图，高风险组表达显著高于低风险组，P=0.003(4A), 在9个验证集进行检验，7个结果一致（4B），其余两个因缺少PD-L1表达芯片，无法检测。然后，作者进一步比较了两组TMB，在TCGA LUAD 数据集中，高风险组病人TMB比低风险组更高（4C）。然后进行多因素分析做出森林图4D, 在纳入几个突变特征：年龄相关的5-甲基胞嘧啶脱氨基化(signature 1)，mRNA编辑酶APOBECA过度激活(signature 2)，吸烟相关的C>A 突变(signature 4)，以及一些DNA修复基因突变等因素后，结果仍然成立。且高风险组非同义突变负荷也更高（4E），综合说明高风险组的ICB治疗效果可能更好。

![Error](https://github.com/bigone1/test/blob/master/Screenshots/26.jpg)

##### 4.高风险组功能特点

作者使用R包 limma 与DESeq2计算芯片数据与*RNA*-seq数据差异表达T统计量，将T统计量输入fgsea包进行基因富集分析。5A展示了两组信号通路的异常表达，高风险组病人细胞周期相关通路显著高表达，FDR < 0.001。5B为细胞周期检查点分子在两组的表达，高风险组细胞周期检查点分子表达上调，P< 0.001(5B), 这两点是导致高风险组病人预后差的重要原因。

![Error](https://github.com/bigone1/test/blob/master/Screenshots/27.jpg)

##### 6.分型相关SMGs突变模式

作者使用MutSigCV算法鉴定显著突变基因（SMGs），需满足q < 0.1，在TCGA LUAD与细胞系百科全书中都表达，突变率>3%。最终作者确定了23个显著突变基因（SMGs）。使用多元逻辑回归分析SMGs突变率与亚型间的关系，其中TP53, NAV3, COL11A1，KEAP1 ，SMARCA4在高风险组更易突变，排除年龄，性别，吸烟，肿瘤分期等临床变量影响后关系仍然成立。此外，作者使用秩和检验与卡方检验比较两亚型间的连续变量和分类变量，高风险组病人多为男性，吸烟者，处于临床晚期阶段。

![Error](https://github.com/bigone1/test/blob/master/Screenshots/28.jpg)

## ROC曲线

![Error](https://github.com/bigone1/test/blob/master/Screenshots/29.png)

## 归一化与标准化

| 对比点   | 归一化                                                       | 标准化                                                       |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 概念     | 将数值规约到(0,1)或者是(-1,1)区间                            | 将对应数据的分布规约在均值为0，标准差为1的分布上(近似高斯分布) |
| 侧重点   | 数值的归一，丢失数据的分布信息，对数据之间的距离没有得到较好的保留，但保留了权值 | 数据分布的归一，较好的保留了数据之间的分布，但是数据对于权重没有得到保留，因为规约化的分母是标准差，而标准差的大小也间接代表着权重的大小，导致规约后的分布，各个数据/样本的权重是平等的，但是保留样本之间的距离 |
| 形式     | ![Error](https://github.com/bigone1/test/blob/master/Screenshots/34.png) <br>                   Min-Max 归一化：依赖所有的样本数据 | ![Error](https://github.com/bigone1/test/blob/master/Screenshots/35.png)<br>零均值标准化(Z-score)：依赖所有的样本数据或者简单形式：![Error](https://github.com/bigone1/test/blob/master/Screenshots/36.png)<br/>Z-score:是动态使用的，只依赖当前的数据x，x越大证明x*越小，这样就可以把很大的数规范在[0-1]之间 |
| 缺点     | 1.丢失样本间的距离信息<br>2.鲁棒性较差：max为样本数据的最大值，min为样本数据的最小值，当有新的样本加入的时候，最大值与最小值非常容易受异常点的影响 | 1.丢失样本间的权重信息：分母是间接代表权重的标准差           |
| 适合场景 | 1.小数据/固定数据的时候使用<br>2.在不涉及距离度量、协方差计算、数据不符合正太分布的时候<br>3.进行多指标综合评价的时候 | 1.在分类、聚类算法中，需要使用距离来度量相似性的时候、或者使用PCA技术进行降维的时候，标准化方法表现更好<br>2.有较好的鲁棒性，有超出取值范围的离散数据或对最大值或最小值未知的情况 |
| 缩放方式 | 先使用最小值平移，后使用最值差缩放                           | 先使用均值u平移，之后用标准差o进行缩放                       |
| 目的     | 便于消除量纲，将各个指标的数据纳入到综合评价中               | 便于后续的梯度下降和激活函数对数据的处理，因为标准化后，数据以0为中心左右分布（不一定对称），而函数Sigmoid、Tanh、Softmax等也都以0为中心左右分布（不一定对称） |

```
标准差与权重:某个指标数据对应的数据集标准差过大,说明其不确定性增加,所提供的信息量也会增加,因此在进行综合指标评价的时候,权重也会对应的增大
```



## C++

C++融合了3种不同的编程方式：C语言代表的过程性语言，C++在C语言基础上添加的类代表的面向对象语言(OOP)，C++模版支持的泛型编程。

变量名：1，只能使用字母字符、数字和下划线；2，第一个字符不能是数字；

short至少16位；int至少与short一样长；long至少32位，且至少与int一样长；long long至少64位，且至少与long一样长。

sizeof运算符返回类型或变量的长度，单位为字节；sizeof用于数组名，得到的是整个数组中的字节数

### 头文件内容

1、函数原型

2、使用#define或const定义的符号常量

3、结构声明

4、类声明

5、模版声明

6、内联函数

### 自动存储持续性：

在函数定义中声明的变量（包括函数参数）的存储持续性为自动的。它们在程序开始执行其所属的函数或代码块时被创建，在执行完函数或代码块时，它们使用的内存被释放。C++有两种存储持续性为自动的变量。

### 静态存储持续性：

在函数定义外定义的变量和使用关键字static定义的变量的存储持续性都为静态。它们在程序整个运行过程中都存在。C++有3种存储持续性为静态的变量。

要创建链接性为外部的静态持续变量，必须在代码块的外面声明它；

要创建链接性为内部的静态持续变量，必须在代码块的外面声明它，并使用static限定符；

要创建没有链接性的静态持续变量，必须在代码块内声明它，并使用static限定符。

### 线程存储持续性：

当前，多核处理器很常见，这些CPU可以同时处理多个执行任务。这让程序能够将计算放在可并行处理的不同线程中。如果变量是使用关键字thread_local声明的，则其生命周期与所属的线程一样长。

### 动态存储持续性：

用new运算符分配的内存将一直存在，直到使用delete运算符将其释放或程序结束为止。这种内存的存储持续性为动态，有时被称为自由存储或堆。

### 不能重载的运算符：

| sizeof           | sizeof运算符       |
| ---------------- | ------------------ |
| .                | 成员运算符         |
| .*               | 成员指针运算符     |
| ::               | 作用域运算符       |
| ?:               | 条件运算符         |
| typeid           | 一个RTTI运算符     |
| const_cast       | 强制类型转换运算符 |
| dynamic_cast     | 强制类型转换运算符 |
| reinterpret_cast | 强制类型转换运算符 |
| static_cast      | 强制类型转换运算符 |

### 只能通过成员函数进行重载的运算符：

| =    | 赋值运算符                 |
| ---- | -------------------------- |
| ()   | 函数调用运算符             |
| []   | 下标运算符                 |
| ->   | 通过指针访问类成员的运算符 |

### 可重载的运算符：

| +    | -    | *    | /      | %     | ^        |
| ---- | ---- | ---- | ------ | ----- | -------- |
| &    | \|   | ~=   | ！     | =     | <        |
| >    | +=   | -=   | *=     | /=    | %=       |
| ^=   | &=   | \|=  | <<     | >>    | >>=      |
| <<=  | ==   | !=   | <=     | >=    | &&       |
| \|\| | ++   | --   | ,      | ->*   | ->       |
| ()   | []   | new  | delete | new[] | delete[] |

### 野指针

**野指针与垂悬指针的区别**：

**野指针**：访问一个已销毁或者访问受限的内存区域的指针，野指针不能判断是否为NULL来避免。

**垂悬指针**：指针正常初始化，曾指向一个对象，该对象被销毁了，但是指针未置空，就成为垂悬指针。

**概念**：指针指向一块随机的空间，不受程序控制。

**产生的原因：**

1、指针定义时未被初始化：指针在定义的时候，如果程序不对其进行初始化的话，它会随机指向一个区域，因为任意指针变量（除了static修饰的指针）的默认值都是随机的。

2、指针释放时没有置空：使用free或者delete释放指针后，如果没有对其进行置空或者其他赋值操作。

3、指针操作超越变量作用域：不要返回栈内存的指针或引用，因为栈内存在函数结束的时候会被释放。

**危害**：

指针指向的内容已经失效了，而没有被置空，解引用一个非空的无效指针是一个未被定义的行为。

**规避方法：**

1、初始化指针的时候将其置为nullptr，之后对其操作；

2、释放指针的时候将其置为nullptr。

### 多态公有继承

所谓多态公有继承，就是同一个方法在派生类和基类中的行为不同。

实现多态公有继承的机制：
1、在派生类重新定义基类的方法 
2、使用虚方法

### 使用虚函数时，在内存和执行速度方面有一定的成本：

1、每个对象都将增大，增大量为存储地址的空间

2、对于每个类，编译器都创建一个虚函数地址表（数组）

3、对于每个函数调用，都需要执行一项额外的操作，即到表中查找地址

### 构造函数不能是虚函数。

### 友元不能是虚函数，因为友元不是类成员，而只有成员才能是虚函数。

### 如果基类中函数有重载，则应该在派生类中重新定义所有的基类版本。

### protected

protected与private相似，在类外只能用公有类成员来访问protected部分中的类成员。private和protected之间的区别只有在基类派生的类中才会表现出来。派生类的成员可以直接访问基类的保护成员，但不能直接访问基类的私有成员。